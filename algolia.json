[
    {
        "title": "Kubernetes 实践指南",
        "uri": "",
        "content": "notice info                                                    notice                                 children depth 10                                                                                    https   k8s imroc io English  https   k8s imroc io en              Github    https   github com imroc kubernetes practice guide                       CONTRIBUTING License                  4 0   CC BY NC SA 4 0",
        "objectID": ""
    },
    {
        "title": "避坑指南",
        "uri": "avoid",
        "content": "children depth 2",
        "objectID": "avoid",
        "weight": 30
    },
    {
        "title": "踩坑分享",
        "uri": "avoid/cases",
        "content": "children",
        "objectID": "avoid/cases"
    },
    {
        "title": "ARP 缓存爆满导致健康检查失败",
        "uri": "avoid/cases/arp-cache-overflow-causes-healthcheck-failed",
        "content": "TKE           1200          daemonset    node exporter             hostNework    statefulset    promethues                  promethues        node exporter                        arp cache       node          1200      net ipv4 neigh default gcthresh3      1024          arp cache              gc        gc             arp         arp          arp cache     1     gcthresh3          arp    mac              arp_cache  neighbor table overflow       arp         mac                            veth pair  kubelet     pod        arp   mac      arp cahce          arp cache        gc                          pod                   arp cache   gc        etc sysctl conf   net ipv4 neigh default gc_thresh1   80000 net ipv4 neigh default gc_thresh2   90000 net ipv4 neigh default gc_thresh3   100000    node   label    pod spec    nodeSelector    nodeAffnity   pod                                arp_cache",
        "objectID": "avoid/cases/arp-cache-overflow-causes-healthcheck-failed"
    },
    {
        "title": "跨 VPC 访问 NodePort 经常超时",
        "uri": "avoid/cases/cross-vpc-connect-nodeport-timeout",
        "content": "VPC    VPC b   TKE          NodePort                                      server   NodePort          server     SYN      ACK       netstat  s   grep LISTEN    SYN                  VPC            CVM                            VPC          VPC                        client         client   VPC   TKE           client   VPC   TKE       server   VPC b   TKE          TKE        ip masq agent   daemonset     node   iptables       SNAT    IP   VPC          client    server    SNAT        VPC     VPC    NodePort      SNAT           SNAT                              server              server    node              node      TKE node              node net ipv4 tcptwrecycle   1                                             TCP                  ACK     TIME_AWAIT        2   MSL              server     client           server          FIN       client      2 MSL                       2 MSL                                                      TCP          tcptwrecycle        TIMEAWAIT                                        twbuckets                time wait bucket table overflow     tcptwrecycle       RFC1323         additional mechanism added TCP  per host cache last timestamp received connection  value used PAWS mechanism reject old duplicate segments earlier incarnations connection  timestamp clock guaranteed ticked least once old connection open  require TIME WAIT delay plus RTT together least one tick sender s timestamp clock  extension not part proposal RFC           TCP                                                           Linux             tcptimestamps   tcptwrecycle    tcptimestamps          tcptwrecycle                             NAT                          NAT                         IP                                                                                                                     SYN           ACK           client              pod     server            SNAT    client       NODE IP          server                 tcptwrecycle   tcp_timestamps                             SYN                         server     SYN       ACK         client                  tcptwrecycle         4 12        remove tcptwrecycle",
        "objectID": "avoid/cases/cross-vpc-connect-nodeport-timeout"
    },
    {
        "title": "DNS 5 秒延时",
        "uri": "avoid/cases/dns-lookup-5s-delay",
        "content": "pod                      5                         nsenter    pod netns        tcpdump   pod                        DNS             5         DNS              kube dns pod         DNS        kube dns pod               5    man resolv conf      glibc   resolver          5s  timeout n Sets amount time resolver will wait response remote name server retrying query via different name server  Measured seconds  default RES_TIMEOUT  currently 5     value option silently capped 30                               conntrack     bug netfilter   NAT                    Weave works     Martynas Pumputis               Racy conntrack DNS lookup timeouts                        socket          UDP               glibc  musl  alpine linux libc        parallel query                                          ipvs      conntrack     kube proxy   ipvs                      Martynas          patch   fix                  DNS server                     patch     2018 7 18      linux        netfilter  nf _conntrack  resolve clash matching conntracks     4 19 rc       patch               TCP  DNS     TCP                 resolv conf   options use vc    glibc  TCP    DNS query      man resolv conf            use vc  since glibc 2 14  Sets RESUSEVC res options  option forces use TCP DNS resolutions         busybox 1 29 3 glibc    libc 2 24                          UDP  DNS                 DNS      resolv conf             single request reopen   since glibc 2 9   single request   since glibc 2 10   man resolv conf       single request reopen  since glibc 2 9  Sets RESSNGLKUPREOP res options  resolver uses socket AAAA requests  hardware mistakenly sends back one reply  When happens client system will sit wait second reply  Turning option changes behavior so two requests port not handled correctly will close socket open new one sending second request  single request  since glibc 2 10  Sets RESSNGLKUP res options  default  glibc performs IPv4 IPv6 lookups parallel version 2 9  appliance DNS servers cannot handle queries properly requests time out  option disables behavior makes glibc perform IPv6 IPv4 requests sequentially  at cost slowdown resolving process             single request reopen           AAAA                      conntrack                   single request                  AAAA                           resolv conf    options           1         ENTRYPOINT      CMD          bin echo  options single request reopen   gt  gt   etc resolv conf 2     pod   postStart hook    lifecycle  postStart  exec  command   bin sh  c   bin echo  options single request reopen      etc resolv conf  3      template spec dnsConfig   k8s v1 9           template  spec  dnsConfig  options  name  single request reopen 4      ConfigMap    pod      etc resolv conf  configmap  apiVersion  v1 data  resolv conf    nameserver 1 2 3 4 search default svc cluster local svc cluster local cluster local ec2 internal options ndots 5 single request reopen timeout 1 kind  ConfigMap metadata  name  resolvconf pod spec  volumeMounts  name  resolv conf mountPath   etc resolv conf subPath  resolv conf     volumes  name  resolv conf configMap  name  resolvconf items  key  resolv conf path  resolv conf 5      MutatingAdmissionWebhook MutatingAdmissionWebhook   1 9     Controller          Resource           resource       istio     sidecar                       MutatingAdmissionWebhook       POD     3    4                   1   2           3   4        POD spec                               yaml               helm            helm charts   5                                                 DNS      DNS        DNS      dnsmasq  nscd        DNAT      conntrack               DNS              DNS                 DNS             DNS               DNS        nameserver                                           coredns   cache      daemonset          https   kubernetes io docs tasks administer cluster nodelocaldns                                    POD        DNS            IP                 bridge          bridge      IP   TKE         cbr0       DNS               POD  etc resolv conf  nameserver     IP            POD spec dnsPolicy    Default      POD     etc resolv conf                     etc resolv conf    kubelet      resolv conf             resolv conf                       kubelet       cluster dns         IP POD spec dnsPolicy        ClusterFirst   kops      issue                cluster dns    IP  https   github com kubernetes kops issues 5584      Racy conntrack DNS lookup timeouts  https   www weave works blog racy conntrack and dns lookup timeouts 5   15s DNS lookups Kubernetes    https   blog quentin machu fr 2018 06 24 5 15s dns lookups on kubernetes  DNS intermittent delays 5s  https   github com kubernetes kubernetes issues 56903    Docker Kubernetes                  https   mp weixin qq com s VYBs8iqf0HsNg9WAxktzYQ",
        "objectID": "avoid/cases/dns-lookup-5s-delay"
    },
    {
        "title": "DNS 解析异常",
        "uri": "avoid/cases/dns-resolution-abnormal",
        "content": "coredns   log   ERROR  2 loginspub xxxxmobile inc net  A  unreachable backend  read udp 172 16 0 230 43742  10 225 30 181 53  i o timeout      DNS                coredns         DNS           DNS     coredns pod        resolv conf     nameserver  coredns pod   dnsPolicy    Default             resolv conf    nameserver        resolv conf  coredns      proxy    etc resolv conf       service       coredns     resolv conf      nameserver                 DNS 10 225 30 181        nameserver VPC    DNS     180        coredns       resolv conf               nameserver            DNS                    nameserver      resolv conf              10 225 30 181                DNS         VIP             coredns       DNS        timeout             VPC           nameserver                       CVM     TKE          nameserver       TKE                TKE       CVM     TKE                      K8S   node              resolv conf      TKE   OS               etc resolv conf          nameserver   IP       etc resolvconf resolv conf d base           etc resolvconf resolv conf d base     Ubuntu    etc resolv conf                 etc resolvconf resolv conf d base          etc resolv conf                 TKE   Ubuntu OS             OS                    VPC         etc resolv conf       IP       OS              IP                  dhcp    cvm   cloud init      etc resolv conf     dns dhcp    cloud init           dhcp      2018   4         VPC     dhcp           VPC    dhcp           etc resolv conf           etc resolvconf resolv conf d base                 nameserver     VPC      dhcp       cloud init      etc resolv conf          nameserver       VPC    dhcp    cloud init       etc resolv conf         nameserver       etc resolv conf   coredns pod   dnsPolicy    Default             etc resolv conf    nameserver       coredns                nameserver                nameserver     timeout            etc resolvconf resolv conf d base                 TKE Ubuntu OS                    But                               dns timeout                   loginspub xxxxmobile inc net                 accounts google com               dns            netns     dns           AAAA                     wireshark                       dns              AAAA       id       AAAA            id                  dns           loginspub xxxxmobile inc net    AAAA  ipv6               client             id                     client    id                     accounts google com   AAAA           client                        ipv6              dns    id                     pod                        pod             alpine                         alpine latest                  alpine                                             alpine                 alpine       c    musl libc          glibc   musl libc        dns        id                    network res_mkquery c      reasonably unpredictable id    clockgettime CLOCKREALTIME   ts   id   ts tvnsec   ts tvnsec 65536UL   0xffff              id                                          musl libc   dns    id                                          id                                                                      cvm                 OK                                       alpine                  c     go            cgo  CGO_ENABLED 0               go build      ldflags   d                                           debian stretch slim",
        "objectID": "avoid/cases/dns-resolution-abnormal"
    },
    {
        "title": "驱逐导致服务中断",
        "uri": "avoid/cases/eviction-leads-to-service-disruption",
        "content": "TODO       TKE                 nfs                pod            10min                pod                  kube dns      service                                                node    pod    replicaset        pod            pod       node                                   deployment    pod                                  pod   kubelet   kube dns                           kube dns          pod    service                                                  kubelet       kube dns                                     1 2GB                kube dns                      kubelet            registry burst                              serialize image pulls         kubelet                      true                               kube dns                                         preStop hook   readinessProbe",
        "objectID": "avoid/cases/eviction-leads-to-service-disruption"
    },
    {
        "title": "Pod 访问另一个集群的 apiserver 有延时",
        "uri": "avoid/cases/high-legacy-from-pod-to-another-apiserver",
        "content": "Pod     kubectl      b                                                     pod         apiserver   ip     hosts    TKE apiserver                  LB             DNS                 apiserver     hosts pod     kubectl             5s     10s     5s          conntrack       DNS    5S            hosts                pod netns        kubectl      dns              dns                             conntrack      dns 5s                           hosts               hosts         dns                           etc nsswitch conf             pod                   pod    alpine                  alpine                    musl libc        etc nsswitch conf       alpine                             musl libc   gethostbyname   getaddrinfo                              hosts       dns             hosts    dns                 dns         hosts             dns       apiserver   client   kubectl   go         go               c    gethostbyname   getaddrinfo              go runtime   go     glibc   getaddrinfo              c               cgo             issue  net  replicate DNS resolution behaviour getaddrinfo glibc  go dns resolver         Unix    OS      openbsd  go runtime      etc nsswitch conf  net conf go   runtime GOOS     openbsd    confVal nss   parseNSSConfFile   etc nsswitch conf     hostLookupOrder               Linux        nsswitch conf     dns   hosts       net conf go      hostLookupOrder determines strategy use resolve hostname     provided Resolver optional  nil means not consider its options  func  c conf  hostLookupOrder r Resolver  hostname string   ret hostLookupOrder               etc nsswitch conf doesn t exist doesn t specify    sources  hosts   assume Go s DNS will work fine  os IsNotExist nss err      nss err    nil    len srcs     0           c goos     linux       glibc says default  dns   UNAVAIL return  files     https   www gnu org software libc manual html_node Notes on NSS Configuration File html  return hostLookupDNSFiles   return hostLookupFilesDNS        hostLookupDNSFiles      dns first  net dnsclient_unix go      hostLookupOrder specifies order LookupHost lookup strategies     basically simplified representation nsswitch conf      files  means  etc hosts  type hostLookupOrder int const      hostLookupCgo means defer cgo  hostLookupCgo hostLookupOrder   iota hostLookupFilesDNS    files first hostLookupDNSFiles    dns first hostLookupFiles    files hostLookupDNS    DNS   var lookupOrderName   map hostLookupOrder string  hostLookupCgo   cgo   hostLookupFilesDNS   files dns   hostLookupDNSFiles   dns files   hostLookupFiles   files   hostLookupDNS   dns          alpine    musl libc    glibc   go              glibc       alpine     etc nsswitch conf             kubectl    apiserver    dns            hosts            dns       conntrack          dns 5s              pod    kubectl    apiserver      5s         10s          dns         conntrack            5s                  alpine    nsswitch conf         hostPath",
        "objectID": "avoid/cases/high-legacy-from-pod-to-another-apiserver"
    },
    {
        "title": "神秘的溢出与丢包",
        "uri": "avoid/cases/kubernetes-overflow-and-drop",
        "content": "k8s ingress    ingress        service              nginx deployment    deployment                nfs   nginx      nfs                         client     k8s ingress     nginx     nfs         ingress                         k8s      curl nginx   pod ip                                 nginx pod            netns       pod   nginx     id   kubectl describe pod tcpbench 6484d4b457 847gl   grep  A10   Containers     grep  Eo  docker         head  n 1   sed  s docker             1   49b4135534dae77ce5151c6c7db4d528f05b69b0c6f8b9dd037ec4e7043c113e      id    nginx    pid   docker inspect  f    State Pid   49b4135534dae77ce5151c6c7db4d528f05b69b0c6f8b9dd037ec4e7043c113e 3985    nginx       netns   nsenter  n  t 3985      netns              ip 1  lo  mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link loopback 00 00 00 00 00 00 brd 00 00 00 00 00 00 inet 127 0 0 1 8 scope host lo validlft forever preferredlft forever 3  eth0 if11  mtu 1500 qdisc noqueue state group default link ether 56 04 c7 28 b0 3c brd ff ff ff ff ff ff link netnsid 0 inet 172 26 0 8 26 scope global eth0 validlft forever preferredlft forever    tcpdump      24568     netns   eth0       tcpdump  i eth0  nnnn  ttt port 24568           nc        24568        nc  u 24568 172 16 1 21 80         00 00 00 000000 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000206334 ecr 0 nop wscale 9   length 0 00 00 01 032218 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000207366 ecr 0 nop wscale 9   length 0 00 00 02 011962 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000209378 ecr 0 nop wscale 9   length 0 00 00 04 127943 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000213506 ecr 0 nop wscale 9   length 0 00 00 08 192056 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000221698 ecr 0 nop wscale 9   length 0 00 00 16 127983 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000237826 ecr 0 nop wscale 9   length 0 00 00 33 791988 IP 10 0 0 3 24568   172 16 1 21 80  Flags  S   seq 416500297  win 29200  options  mss 1424 sackOK TS val 3000271618 ecr 0 nop wscale 9   length 0 SYN                ACK                                          netns    iptables                 iptables          netns     netstat  s               netstat  s   grep  E  overflow drop  12178939 times listen queue socket overflowed 12247395 SYNs LISTEN sockets dropped                                        syn queue   accept queue Linux                  socket         syn queue        server    SYN          SYN_RCVD        syn queue                    TCP            accept queue          TCP                ESTABELISHED      syn queue    accept queue         accept                                               accept                               nginx    HTTP                   TCP             listen   accept                server                        listen                    accept                                      go             listen      l  err    net Listen  tcp     80   err    nil   panic err              accept          accept queue         conn  err    l Accept   err    nil   log Println  accept error    err  continue                               go handle conn    Linux   backlog            socket     syn queue   accept queue                                                                                        listen         int listen int sockfd  int backlog                   backlog          man listen       behavior backlog argument TCP sockets changed Linux 2 2  specifies queue length completely established sockets waiting accepted  instead number incomplete connection requests  maximum length queue incomplete sockets set using  proc sys net ipv4 tcpmaxsyn_backlog  When syncookies enabled no logical maximum length setting ignored  tcp 7  information  backlog argument greater value  proc sys net core somaxconn  silently truncated value  default value file 128  kernels 2 4 25  limit hard coded value  SOMAXCONN  value 128                         listen   backlog         socket   syn queue   accept queue     accept queue        net core somaxconn       max accept queue size   min backlog  net core somaxconn        syncookies  net ipv4 tcp_syncookies 1    syn queue    server          SYN      SYN ACK   client        syn queue              syncookies                 SYN ACK      client   ACK   server     syncookies                                syncookies syn queue              syncookies                   syn queue        syncookies       SYN Flood           DDoS            client     SYN         ACK    server   syn queue              server          syncookies      syn queue             accept queue     net core somaxconn             net ipv4 tcpmaxsyn_backlog        max syn queue size   min backlog  net core somaxconn  net ipv4 tcpma",
        "objectID": "avoid/cases/kubernetes-overflow-and-drop"
    },
    {
        "title": "访问 externalTrafficPolicy 为 Local 的 Service 对应 LB 有时超时",
        "uri": "avoid/cases/lb-with-local-externaltrafficpolicy-timeout-occasionally",
        "content": "TKE       LoadBalancer     Service externalTrafficPolicy     Local      Service       LB        externalTrafficPolicy   Local   Service               IP        Source IP Services Type LoadBalancer TKE   LoadBalancer    Service       CLB          Service   NodePort CLB    SNAT       NodePort    IP          IP    NodePort    Service   externalTrafficPolicy    Local      SNAT   pod             IP        Local       SNAT      node     Service   endpoint       pod                    node    pod       SNAT          SNAT            IP    LB         NodePort            LB               NodePort                                   Service      pod            endpoint              LB                               LB             rs         LB                 rs            endpoint   node                 endpoint   node    NodePort            LB   SYN        ACK                  cbr0            LB          cbr0                     k8s   1 12     ipvs    local   service             1 12    ipvs        ipvs            Local   LoadBalancer Service      ipvs                  ipvs                 1 10         ipvs                        ipvs     1 12    1 10    ipvs      1 12     LB   EXTERNAL IP    kube ipvs0     1 10        ip show kube ipvs0   grep  A2 170 106 134 124 inet 170 106 134 124 32 brd 170 106 134 124 scope global kube ipvs0 validlft forever preferredlft forever 170 106 134 124   LB     IP 1 12    ipvs      LB     IP     kube ipvs0     kube ipvs0     dummy interface                      DOWN       ipvs     VIP    ipvs       netfilter   INPUT        PREROUTING               INPUT    FORWARD         IP      INPUT          FORWARD            k8s    kube ipvs0       service     VIP             INPUT     ipvs       IP     kube ipvs0             IP    local       ip route show table local   grep 170 106 134 124 local 170 106 134 124 dev kube ipvs0 proto kernel scope host src 170 106 134 124       local      IP     IP   linux                        IP     IP       LB        IP    LB IP     Service   EXTERNAL IP          IP     kube ipvs0      local             LB                      LB IP   local        ip route del table local local 170 106 134 124 dev kube ipvs0 proto kernel scope host src 170 106 134 124      node    LB                         LB IP     kube ipvs0           LB          LB                                 LB              CLB          IP    LB     IP         LB       IP     IP    LB     VIP                   accept_local     linux     IP     IP                   cbr0      LB               pod       eth0       LB                        LB         IP   Port           IP  Port      IP    LB IP         netns      veth pair   cbr0         netfilter         PREROUTING         IP     IP    INPUT                    INPUT           Port   LB       Port               Service               IPVS    IPVS           kube ipvs0         IP       dummy interface                          1 12    ipvs    EXTERNAL IP   kube ipvs0    k8s   kube proxy    ipvs   proposal               LB    Service   status    ingress IP      kubectl service     EXTERNAL IP           IP   kube ipvs0            ipvs           kube ipvs0      IP           INPUT   ipvs          ipvs                                          1 10                 1 12       IP              59976    issue              63066    PR         PR        LB IP    kube ipvs0        1 11           59976          LB IP  kube ipvs0           MetalLB     LoadBalancer     Service          pod         LB      pod    LB IP            LB IP    kube ipvs0        ipvs     LB    Service     pod             LB        63066   PR           63066    PR             kube proxy            kube proxy       LB             IP          IP                                                                                  issue             79783          CLB      SNAT        IP         IP          LB IP               LB                 CLB               CVM                    LB       CLB    SNAT                  nodeport              IP   LB IP     kube ipvs0                         LB                       SNAT   LB                LB IP                issue       AWS   LB    SNAT       LB   IP    Service   Status       hostname        LB IP   kube ipvs0       hostname    LB                    hostname        kubectl svc      k8s            LB IP                   79976    PR           kube proxy     exclude external ip    flag       LB IP    ipvs       kube ipvs0          kube proxy flag     kube proxy             iptables                              PR",
        "objectID": "avoid/cases/lb-with-local-externaltrafficpolicy-timeout-occasionally"
    },
    {
        "title": "Pod 偶尔存活检查失败",
        "uri": "avoid/cases/livenesprobe-failed-occasionally",
        "content": "Pod              Pod                                                                                                                                                                     backlog           net ipv4 tcpmaxsyn_backlog     1024            TCP      SYN                            TCP             server    SYN         SYN            ACK               SYN        ACCEPT      SYN                              SYN                                      SYN         tcpmaxsyn_backlog      SYN            backlog       1024    8096",
        "objectID": "avoid/cases/livenesprobe-failed-occasionally"
    },
    {
        "title": "LB 压测 NodePort CPS 低",
        "uri": "avoid/cases/low-cps-from-lb-to-nodeport",
        "content": "LoadBalancer     Service      NodePort CPS           LB CPS                   TKE      TKE           LB              LoadBalancer     Service         LB        NodePort      LB        NodePort           pod         TKE            client       SYN    server       NodePort        client SYN     server     SYN            SYN               tcptwrecycle                                            conntrack  S    insert_failed             conntrack                                            netfilter conntrack           conntrack                                       conntrack                              NAT                                                      SYN      NAT                  SYN     NAT        SYN         SYN   NAT                      NAT                                    netfilter   SNAT              LB    SNAT SNAT      16     IP            Port              SYN  SYN b   LB SNAT    IP      Port                  LB SNAT       IP     Port              NodePort      SNAT         Pod       NodePort              netfilter          conntrack    SYN     SNAT          port_range        Port                           Port       SYN   Port          Port             SYN     Port      conntrack       netfilter      Port           SYN b         Port               SYN   conntrack          SYN b   conntrack                  SYN b   conntrack                           iptables   MASQUERADE         random fully    flag                                           LB     Pod IP     NodePort      netfilter   SNAT",
        "objectID": "avoid/cases/low-cps-from-lb-to-nodeport"
    },
    {
        "title": "诡异的 No route to host",
        "uri": "avoid/cases/no-route-to-host",
        "content": "Deployment                   No route host                       No route host                               Connection reset peer                   server     client           RST                 server         client   server                      grpc            server      Pod                         Pod                 Pod     IP    kube proxy         IP                     IP                     IP    Pod                      Pod IP              IP    Pod      Pod                    RST   client                              Pod    Terminating        SIGTERM                                      Connection refused                  client     SYN             server                 RST                     server            Pod                        client       iptables ipvs                        Pod     k8s   controller      Pod     service   endpoint       kube proxy watch             iptables ipvs                               Pod            iptables ipvs                            preStop       Pod               kube proxy                          Pod     preStop     lifecycle  preStop  exec  command   bin bash  c sleep 30           Pod              Ready                                Pod                              readinessProbe                    Ready    kube proxy                               Pod readinessProbe     readinessProbe  httpGet  path   healthz port  80 httpHeaders  name  X Custom Header value  Awesome initialDelaySeconds  15 timeoutSeconds  1 Connection timed out                 client   SYN                     ACK                     Connection refused                                           Pod                                        Pod                                             preStop   readinessProbe                    No route host                IP                         Pod                          Pod                  Pod            Ready    kube proxy                              Pod                          Pod                                  Pod          Pod    PodCIDR   Node    Node            IP        Node     ICMP     client    IP     client    ICMP            No route host                   Pod                                  Pod                   preStop      kube proxy               Kubernetes             https   k8s imroc io best practice high availability deployment of applications smooth update using prestophook and readinessprobe                     No route host                                                      preStop                           No route host                                                                              ServiceA   ServiceB    ab         ServiceA          ServiceA     RPC    ServiceB              ServiceB       ServiceA    ServiceB         ServiceB           Pod Ready          IPVS     RS        Pod               Pod     1      0     client        IPVS          root VM 0 3 ubuntu    ipvsadm  ln  t 172 16 255 241 80 Prot LocalAddress Port Scheduler Flags    RemoteAddress Port Forward Weight ActiveConn InActConn TCP 172 16 255 241 80 rr    172 16 8 106 80 Masq 0 5 14048    172 16 8 107 80 Masq 1 2 243            Pod                                      ActiveConn InactiveConn 0                  https   github com kubernetes kubernetes blob v1 17 0 pkg proxy ipvs graceful_termination go L170       ipvsadm  lnc   grep 172 16 8 106     Pod         TIMEWAIT               ServiceA    client           ServiceB            TCP         TIMEWAIT       2 MSL  2                                            No route host            0             Pod             root VM 0 3 ubuntu    tcpdump  i eth0 host 172 16 8 106  n  tttt tcpdump  verbose output suppressed  use  v  vv full protocol decode listening eth0  link type EN10MB  Ethernet   capture size 262144 bytes 2019 12 13 11 49 47 319093 IP 10 0 0 3 36708   172 16 8 106 80  Flags  S   seq 3988339656  win 29200  options  mss 1460 sackOK TS val 3751111666 ecr 0 nop wscale 9   length 0 2019 12 13 11 49 47 319133 IP 10 0 0 3 36706   172 16 8 106 80  Flags  S   seq 109196945  win 29200  options  mss 1460 sackOK TS val 3751111666 ecr 0 nop wscale 9   length 0 2019 12 13 11 49 47 319144 IP 10 0 0 3 36704   172 16 8 106 80  Flags  S   seq 1838682063  win 29200  options  mss 1460 sackOK TS val 3751111666 ecr 0 nop wscale 9   length 0 2019 12 13 11 49 47 319153 IP 10 0 0 3 36702   172 16 8 106 80  Flags  S   seq 1591982963  win 29200  options  mss 1460 sackOK TS val 3751111666 ecr 0 nop wscale 9   length 0           0        SYN       Pod              ACK     Pod                   IPVS                     linux                                  0   rs                                     net netfilter ipvs ipvscore c    ipvsin        IPVS                                                                                        rs                                      rr  wrr                                 0   rs                                                                rs       0                 IPVS                           No route host                                       IPVS                        0   rs   ",
        "objectID": "avoid/cases/no-route-to-host"
    },
    {
        "title": "kubectl edit 或者 apply 报 SchemaError",
        "uri": "avoid/cases/schemaerror-when-using-kubectl-apply-or-edit",
        "content": "kubectl edit   apply          error  SchemaError io k8s apimachinery pkg apis meta v1 APIGroup   invalid object doesn t additional properties      v1 10         kubectl apply  f tmp yaml   dry run  v8       openapi v2    api    kubectl  validate          kubectl 1 12          kubectl   raw   openapi v2        json                   json title   Kubernetes metrics server      Kubernetes      metrics server                k8s     metrics server         0 3 1        0 3 5    metrics server                          metrics server       openapi generator     openapi       k8s                 kubectl     openapi   schema             1 10   1 12       openapi   schema",
        "objectID": "avoid/cases/schemaerror-when-using-kubectl-apply-or-edit"
    },
    {
        "title": "cgroup 泄露",
        "uri": "avoid/cgroup-leaking",
        "content": "Bug memcg   Linux         cgroup                   cgroup                3 10         memory cgroup    kmem accounting    memory kmem limitinbytes              memcg      cssid               cgroup    sys fs cgroup memory      cgroup                     cssid         cgroup                         cgroup           cgroup kernel memory   kernel org         2 7 Kernel Memory Extension  CONFIGMEMCGKMEM  Kernel memory extension  Memory Controller able limit amount kernel memory used system  Kernel memory fundamentally different user memory  can t swapped out  makes possible DoS system consuming precious resource  Kernel memory accounting enabled memory cgroups default  disabled system wide passing cgroup memory nokmem kernel boot time  case  kernel memory will not accounted all  Kernel memory limits not imposed root cgroup  Usage root cgroup may may not accounted  memory used accumulated memory kmem usageinbytes  separate counter when makes sense   currently tcp   main  kmem  counter fed main counter  so kmem charges will visible user counter  Currently no soft limit implemented kernel memory  future work trigger slab reclaim when limits reached       cgroup memory           kernel memory             4 0                    4 x                                    4 3                                              cgroup                       cgroup         65535         commit                          cgroup             cgroup                       65535             cgroup       no space left device    kubernetes          pod             pod        event     Events  Type Reason Age Message                               Normal Scheduled 15m default scheduler Successfully assigned jenkins jenkins 7845b9b665 nrvks 10 10 252 4 Warning FailedCreatePodContainer 25s  x70 15m  kubelet  10 10 252 4 unable ensure pod container exists  failed create container  kubepods besteffort podc6eeec88 8664 11e9 9524 5254007057ba    mkdir  sys fs cgroup memory kubepods besteffort podc6eeec88 8664 11e9 9524 5254007057ba  no space left device dockerd         Dec 24 11 54 31 VM1611centos dockerd 11419   time  2018 12 24T11 54 31 195900301 08 00  level error msg  Handler POST  v1 31 containers b98d4aea818bf9d1d1aa84079e1688cd9b4218e008c58a8ef6d6c3c106403e7b start returned error  OCI runtime create failed  containerlinux go 348  starting container process caused   process_linux go 279  applying cgroup configuration process caused     mkdir  sys fs cgroup memory kubepods burstable pod79fe803c 072f 11e9 90ca 525400090c71 b98d4aea818bf9d1d1aa84079e1688cd9b4218e008c58a8ef6d6c3c106403e7b  no space left device        unknown  kubelet         Sep 09 18 09 09 VM 0 39 ubuntu kubelet 18902   I0909 18 09 09 449722 18902 remoteruntime go 92  RunPodSandbox runtime service failed  rpc error  code   Unknown desc   failed start sandbox container pod  osp xxx com ljqm19 54bf7678b8 bvz9s   Error response daemon  oci runtime error  containerlinux go 247  starting container process caused  process_linux go 258  applying cgroup configuration process caused   mkdir  sys fs cgroup memory kubepods burstable podf1bd9e87 1ef2 11e8 afd3 fa163ecf2dce 8710c146b3c8b52f5da62e222273703b1e3d54a6a6270a0ea7ce1b194f1b5053  no space left device             2 31                        cgroupidralloc      end   0   idralloc        idrallocu32    end            end 0   end 1   INTMAX     INT_MAX      2 31                                                 4 3                         CentOS 7 v3 10                        kmem accounting               kubelet   runc     memory cgroup    kmem accounting               kubelet   runc      kmem accounting           runc runc       PR   2017 02 27                 kmem accounting                          PR 1921   runc      nokmem           release                  nokmem      runc      cd  GO_PATH src github com opencontainers runc  BUILDTAGS  seccomp nokmem  docker ce v18 09 1     runc       kmem accounting           docker          kubelet     1 14                   build tag     kmem accounting  KUBEGITVERSION v1 14 1   build run sh kubelet GOFLAGS   tags nokmem                   kubelet     pod     cgroup          libcontianer       cgroup       pkg kubelet cm cgroupmanagerlinux go   Create         Manager Apply         vendor github com opencontainers runc libcontainer cgroups fs memory go    MemoryGroup Apply       kmem accounting                             kubelet          kubernetes 1 9           CentOS 7 x           http   dockone io article 4797 Cgroup              https   tencentcloudcontainerteam github io 2018 12 29 cgroup leaking",
        "objectID": "avoid/cgroup-leaking"
    },
    {
        "title": "conntrack 冲突导致丢包",
        "uri": "avoid/conntrack-conflict",
        "content": "TODO",
        "objectID": "avoid/conntrack-conflict",
        "state": "TODO"
    },
    {
        "title": ".Net Core 配置文件在Kubernetes中无法热加载",
        "uri": "avoid/dotnet-configuration-auto-reload",
        "content": "",
        "objectID": "avoid/dotnet-configuration-auto-reload",
        "LastModifierDisplayName": "yulibaozi",
        "LastModifierURL": "https://yulibaozi.com",
        "date": "2020-05-09T00:00:00.000Z",
        "state": "TODO"
    },
    {
        "title": "使用 oom-guard 在用户态处理 cgroup OOM",
        "uri": "avoid/handle-cgroup-oom-in-userspace-with-oom-guard",
        "content": "linux     cgroup OOM          bug         cgroup OOM                              TKE       oom guard        cgroup OOM       bug                cgroup OOM kill                         cgroup                            threshold notify       https   lwn net Articles 529927  oom guard    memory cgroup    threshold notify                                pod     memory limit   1000M  oom guard            margin  margin   1000M   marginratio   20M      marginratio 0 02 margin       mimmargin   1M         maxmargin    30M            mimmargin   maxmargin    threshold   limit   margin      1000M   20M   980M   980M               pod          980M    oom guard                   oom gurad      memory force_empty      cgroup                      cgroup   memory stat        cache                  cgroup      limit                                           cgroup OOM                 policy                          process  process       cgroup OOM killer        cgroup        oom_score               oom guard    SIGKILL       container    cgroup      docker           noop                         webhook reporter    k8s event          kubectl event       LAST SEEN FIRST SEEN COUNT NAME KIND SUBOBJECT TYPE REASON SOURCE MESSAGE 14s 14s 1 172 21 16 23 158b732d352bcc31 Node Warning OomGuardKillContainer oom guard  172 21 16 23   hostname   172 21 16 23   timestamp   2019 03 13T07 12 14 561650646Z   oomcgroup    sys fs cgroup memory kubepods burstable pod3d6329e5 455f 11e9 a7e5 06925242d7ea 223d4795cc3b33e28e702f72e0497e1153c4a809de6b4363f27acc12a6781cdb   proccgroup    sys fs cgroup memory kubepods burstable pod3d6329e5 455f 11e9 a7e5 06925242d7ea 223d4795cc3b33e28e702f72e0497e1153c4a809de6b4363f27acc12a6781cdb   threshold  205520896  usage  206483456  killed   16481 fakeOOM     stats   cache 20480 rss 205938688 rsshuge 199229440 mappedfile 0 dirty 0 writeback 0 pgpgin 1842 pgpgout 104 pgfault 2059 pgmajfault 0 inactiveanon 8192 activeanon 203816960 inactivefile 0 activefile 0 unevictable 0 hierarchicalmemorylimit 209715200 totalcache 20480 totalrss 205938688 totalrsshuge 199229440 totalmappedfile 0 totaldirty 0 totalwriteback 0 totalpgpgin 1842 totalpgpgout 104 totalpgfault 2059 totalpgmajfault 0 totalinactiveanon 8192 totalactiveanon 203816960 totalinactivefile 0 totalactivefile 0 total_unevictable 0    policy   Container                yaml  oom guard yaml  apiVersion  v1 kind  ServiceAccount metadata  name  oomguard namespace  kube system apiVersion  rbac authorization k8s io v1 kind  ClusterRoleBinding metadata  name  system oomguard roleRef  apiGroup  rbac authorization k8s io kind  ClusterRole name  cluster admin subjects  kind  ServiceAccount name  oomguard namespace  kube system apiVersion  apps v1 kind  DaemonSet metadata  name  oom guard namespace  kube system labels  app  oom guard spec  selector  matchLabels  app  oom guard template  metadata  annotations  scheduler alpha kubernetes io critical pod     labels  app  oom guard spec  serviceAccountName  oomguard hostPID  true hostNetwork  true dnsPolicy  ClusterFirst containers  name  k8s event writer image  ccr ccs tencentyun com paas k8s event writer v1 6 resources  limits  cpu  10m memory  60Mi requests  cpu  10m memory  30Mi args    logtostderr   unix socket true env  name  NODE_NAME valueFrom  fieldRef  fieldPath  status hostIP volumeMounts  name  unix mountPath   unix name  oomguard image  ccr ccs tencentyun com paas oomguard nosoft v2 imagePullPolicy  Always securityContext  privileged  true resources  limits  cpu  10m memory  60Mi requests  cpu  10m memory  30Mi volumeMounts  name  cgroupdir mountPath   sys fs cgroup memory name  unix mountPath   unix name  kmsg mountPath   dev kmsg readOnly  true command     oom guard   args    v 2   logtostderr   root  sys fs cgroup memory   walkIntervalSeconds 277   inotifyResetSeconds 701   port 0   margin ratio 0 02   min margin 1   max margin 30   guard ms 50   policy container   openSoftLimit false   webhook url http   localhost message env  name  NODE_NAME valueFrom  fieldRef  fieldPath  status hostIP volumes  name  cgroupdir hostPath  path   sys fs cgroup memory name  unix emptyDir     name  kmsg hostPath  path   dev kmsg       kubectl apply  f oom guard yaml             kubectl  n kube system ds oom guard NAME DESIRED CURRENT READY UP TO DATE AVAILABLE NODE SELECTOR AGE oom guard 2 2 2 2 2 6m    AVAILABLE                         oom guard     oom guard    kubectl  n kube system logs oom guard xxxxx oomguard    oom      kubectl events  grep CgroupOOM kubectl events  grep SystemOOM kubectl events  grep OomGuardKillContainer kubectl events  grep OomGuardKillProcess    kubectl delete  f oom guard yaml                        NotReady         ctrl C               pod kubectl pod  n kube system   grep oom guard   awk   print  1   kubectl delete pod  pod  n kube system   grace period 0   force done            kubectl  n kube system ds oom guard       not found                  oom gaurd",
        "objectID": "avoid/handle-cgroup-oom-in-userspace-with-oom-guard"
    },
    {
        "title": "使用 NodeLocal DNS (缓存)",
        "uri": "avoid/nodelocal-dns",
        "content": "DNS         DNS         DNS       netfilter   DNAT    conntrack      DNS 5             DNS          UDP      socket      AAAA         UDP                 conntrack         DNAT        DNS   Pod IP      conntrack       conntrack                     conntrack                   5s            DNS 5           glibc            resolv conf       DNS         TCP                      AAAA            socket                  alpine             musl libc       resolv conf                        DNS           DNS     DaemonSet               hostNetwork   Pod            DNS   IP     Pod   DNS         DNS             TCP        DNS          TCP     socket                   conntrack          conntrack     IPVS         kubelet              ipvs        kubelet   cluster dns          kube dns service   IP     169 254 20 10 Daemonset                 IP Pod        IP   DNS       DNS          DNS iptables         kubelet   cluster dns    Pod          DNS           IP                  DNS       DNS      CLUSTER IP          Service      DNS   Service      selector   endpoint  ipvs         kubelet              DaemonSet Pod                DNS   CLUSTER IP    kube ipvs0    dummy interface        IP     ipvs              INPUT    ipvs        Pod      DNS           ipvs     DNAT     DNS   Pod IP         DNS       DNS         IPVS                 ipvs           DNS            ServiceAccount       DNS   Service  cat",
        "objectID": "avoid/nodelocal-dns",
        "state": "Alpha"
    },
    {
        "title": "解决长连接服务扩容失效",
        "uri": "avoid/scale-keepalive-service",
        "content": "K8S                         Pod        Pod           K8S         Pod                 Pod                                                                   nginx keepalive     nginx   keepalive_requests           TCP                    1000         http   Header      Connection close                               TCP                                                    K8S                TCP         Pod                             Golang                              net Listener   net Conn                           net Conn LocalAddr                1000       Header      Connection close                                Golang           package main import    net   github com gin gonic gin   net http           net Listener type counterListener struct   net Listener        net Listener Accept                  func  c  counterListener  Accept    net Conn  error    conn  err    c Listener Accept   err    nil   return nil  err   return  counterConn Conn  conn   nil           counter     Increment   type counter int func  c  counter  Increment   int    c   return int  c           net Conn      ct type counterConn struct   net Conn ct counter        net Conn LocalAddr                             func  c  counterConn  LocalAddr   net Addr   return  counterAddr c Conn LocalAddr     c ct         TCP                   type counterAddr struct   net Addr  counter   func main     r    gin New   r Use func c  gin Context    localAddr    c Request Context   Value http LocalAddrContextKey  ct  ok    localAddr  interface  Increment   int     ok   ct Increment      1000   c Header  Connection    close       c Next      r GET      func c  gin Context    c String 200   plain text    hello      l  err    net Listen  tcp     8080   err    nil   panic err    err   http Serve  counterListener l   r  err    nil   panic err",
        "objectID": "avoid/scale-keepalive-service"
    },
    {
        "title": "tcp tw recycle 引发丢包",
        "uri": "avoid/tcp_tw_recycle-causes-packet-loss",
        "content": "tcptwrecycle              TIME_WAIT          NAT           RFC1323           additional mechanism added TCP  per host cache last timestamp received connection  value used PAWS mechanism reject old duplicate segments earlier incarnations connection  timestamp clock guaranteed ticked least once old connection open  require TIME WAIT delay plus RTT together least one tick sender s timestamp clock  extension not part proposal RFC        TCP                                                          Linux           tcp timestamps tcp tw recycle   tcp timestamps           tcp tw recycle                           NAT                     NAT               NAT                       IP                                                                                                                    SYN          ACK   4 12        tcp tw recycle      https   git kernel org pub scm linux kernel git torvalds linux git commit  id 4396e46187ca5070219b81773c4e65088dac50cc https   github com torvalds linux commit 4396e46187ca5070219b81773c4e65088dac50cc",
        "objectID": "avoid/tcp_tw_recycle-causes-packet-loss"
    },
    {
        "title": "大数据与 AI",
        "uri": "bigdata-ai",
        "content": "children",
        "objectID": "bigdata-ai",
        "weight": 60
    },
    {
        "title": "Flink on Kubernetes",
        "uri": "bigdata-ai/flink-on-kubernetes",
        "content": "Flink   Kubernetes",
        "objectID": "bigdata-ai/flink-on-kubernetes",
        "weight": 10,
        "chapter": true
    },
    {
        "title": "Flink on Kubernetes 方案",
        "uri": "bigdata-ai/flink-on-kubernetes/flink-on-kubernetes",
        "content": "Flink     Kubernetes   Session Cluster Job Cluster   Native Kubernetes           Session Cluster           Standalone Cluster     TaskManager   JobManager    Deployment            Job Job           TaskManager      slot cpu memory        replicas                                Job Cluster            Job       Flink                Job         Job             Job           Job               Native Kubernetes        Kubernetes                        Kubernetes              TaskManager       flink   yarn   mesos                                                TODO",
        "objectID": "bigdata-ai/flink-on-kubernetes/flink-on-kubernetes",
        "weight": 20,
        "state": "Alpha"
    },
    {
        "title": "Flink 介绍",
        "uri": "bigdata-ai/flink-on-kubernetes/intro",
        "content": "Flink    Apache Flink                                     Flink       streaming execution model                                    SLA                            Exactly once                                                                                   MapReduce Spark            Storm Spark Streaming              Flink                                                  Flink                                                                        Storm                                           exactly once                            Spark    Spark Streaming                                     exactly once                                       Flink                  exactly once                    Flink      JobManager   TaskManager Flink             JobManager   TaskManager              JobManager             TaskManager           k8s      JobManager     Master TaskManager     Worker   Spark    JobManager     Driver TaskManager     Executor  JobManager      Flink                                    TaskManager   TaskSlot                   TaskSlot       TaskManager              JobManager      Master             active JobManager                  JobManager TaskManager    Actor System                  Actor System                               Flink JobManager    Checkpoints      TaskManager       checkpoints        checkpoints      checkpoint       Flink JobManager           JobManager                   TaskManager               TaskManager         slave                                           flink          JobManager   JobManager        jobmanger TaskManager                TaskManager             TaskManager JobManager               slot    task                      TaskManager                                  Flink                                                                            event                                                                         event                                                                                                                https   ci apache org projects flink flink docs release 1 10 concepts programming model html",
        "objectID": "bigdata-ai/flink-on-kubernetes/intro",
        "weight": 10
    },
    {
        "title": "Job Cluster 模式部署",
        "uri": "bigdata-ai/flink-on-kubernetes/job-cluster",
        "content": "",
        "objectID": "bigdata-ai/flink-on-kubernetes/job-cluster",
        "weight": 30,
        "state": "TODO"
    },
    {
        "title": "Native Kubernetes 模式部署",
        "uri": "bigdata-ai/flink-on-kubernetes/native-kubernetes",
        "content": "Kubernetes      flink 1 10      k8s     flink            TaskManager      CPU                                            TaskManager                                       Kubernetes      Flink          Kubernetes            2020 02 11     flink 1 10         k8s              k8s            yarn   mesos               flink     namespace       flink     namespace      kubectl create ns flink    RBAC     ServiceAccount    flink      k8s           apiVersion  v1 kind  ServiceAccount metadata  name  flink namespace  flink apiVersion  rbac authorization k8s io v1 kind  ClusterRoleBinding metadata  name  flink role binding roleRef  apiGroup  rbac authorization k8s io kind  ClusterRole name  edit subjects  kind  ServiceAccount name  flink namespace  flink    job      flink           k8s    jobmanager        service  deployment  configmap   apiVersion  batch v1 kind  Job metadata  name  boot flink namespace  flink spec  template  spec  serviceAccount  flink restartPolicy  OnFailure containers  name  start image  flink 1 10 workingDir   opt flink command    bash     c     FLINK_HOME bin kubernetes session sh    Dkubernetes cluster id roc    Dkubernetes jobmanager service account flink    Dtaskmanager memory process size 1024m    Dkubernetes taskmanager cpu 1    Dtaskmanager numberOfTaskSlots 1    Dkubernetes container image flink 1 10    Dkubernetes namespace flink   kubernetes cluster id     flink               k8s                kubernetes namespace     flink                      flink      kubernetes jobmanager service account          flink     ServiceAccount kubernetes container image     flink                1 10          flink 1 10                      job   pod      job     flink jobmanager   pod       kubernetes cluster id       kubectl  n flink pod NAME READY STATUS RESTARTS AGE roc cf9f6b5df csk9z 1 1 Running 0 84m boot flink nc2qx 0 1 Completed 0 84m    jobmanager   service    kubectl  n flink svc NAME TYPE CLUSTER IP EXTERNAL IP PORT S  AGE roc ClusterIP 172 16 255 152 8081 TCP 6123 TCP 6124 TCP 88m roc rest LoadBalancer 172 16 255 11 150 109 27 251 8081 31240 TCP 88m    http   150 109 27 251 8081       flink     ui          Active Kubernetes integration phase 2   Advanced Features  https   issues apache org jira browse FLINK 14460 Apache Flink 1 10 0 Release Announcement  https   flink apache org news 2020 02 11 release 1 10 0 html Native Kubernetes Setup Beta  flink kubernetes          https   ci apache org projects flink flink docs release 1 10 ops deployment native_kubernetes html",
        "objectID": "bigdata-ai/flink-on-kubernetes/native-kubernetes",
        "weight": 40,
        "state": "Alpha"
    },
    {
        "title": "Session Cluster 模式部署",
        "uri": "bigdata-ai/flink-on-kubernetes/session-cluster",
        "content": "https   ci apache org projects flink flink docs stable ops deployment kubernetes html flink session cluster on kubernetes        flink yaml   apiVersion  v1 kind  ConfigMap metadata  name  flink config labels  app  flink data  flink conf yaml     jobmanager rpc address  flink jobmanager taskmanager numberOfTaskSlots  1 blob server port  6124 jobmanager rpc port  6123 taskmanager rpc port  6122 jobmanager heap size  1024m taskmanager memory process size  1024m log4j properties     log4j rootLogger INFO  file log4j logger akka INFO log4j logger org apache kafka INFO log4j logger org apache hadoop INFO log4j logger org apache zookeeper INFO log4j appender file org apache log4j FileAppender log4j appender file file   log file  log4j appender file layout org apache log4j PatternLayout log4j appender file layout ConversionPattern  d yyyy MM dd HH mm ss SSS    5p   60c  x    m n log4j logger org apache flink shaded akka org jboss netty channel DefaultChannelPipeline ERROR  file apiVersion  apps v1 kind  Deployment metadata  name  flink jobmanager spec  replicas  1 selector  matchLabels  app  flink component  jobmanager template  metadata  labels  app  flink component  jobmanager spec  containers  name  jobmanager image  flink latest workingDir   opt flink command     bin bash     c     FLINK_HOME bin jobmanager sh start          f   find log  name  jobmanager log   print  quit      tail  f  n  1 log jobmanager log  fi  done   ports  containerPort  6123 name  rpc containerPort  6124 name  blob containerPort  8081 name  ui livenessProbe  tcpSocket  port  6123 initialDelaySeconds  30 periodSeconds  60 volumeMounts  name  flink config volume mountPath   opt flink conf securityContext  runAsUser  9999   refers user flink official flink image  change necessary volumes  name  flink config volume configMap  name  flink config items  key  flink conf yaml path  flink conf yaml key  log4j properties path  log4j properties apiVersion  apps v1 kind  Deployment metadata  name  flink taskmanager spec  replicas  2 selector  matchLabels  app  flink component  taskmanager template  metadata  labels  app  flink component  taskmanager spec  containers  name  taskmanager image  flink latest workingDir   opt flink command     bin bash     c     FLINK_HOME bin taskmanager sh start           f   find log  name  taskmanager log   print  quit      tail  f  n  1 log taskmanager log  fi  done   ports  containerPort  6122 name  rpc livenessProbe  tcpSocket  port  6122 initialDelaySeconds  30 periodSeconds  60 volumeMounts  name  flink config volume mountPath   opt flink conf  securityContext  runAsUser  9999   refers user flink official flink image  change necessary volumes  name  flink config volume configMap  name  flink config items  key  flink conf yaml path  flink conf yaml key  log4j properties path  log4j properties apiVersion  v1 kind  Service metadata  name  flink jobmanager spec  type  ClusterIP ports  name  rpc port  6123 name  blob port  6124 name  ui port  8081 selector  app  flink component  jobmanager apiVersion  v1 kind  Service metadata  name  flink jobmanager rest spec  type  NodePort ports  name  rest port  8081 targetPort  8081 selector  app  flink component  jobmanager     kubectl apply  f flink yaml      JobManager   UI    TKE    EKS      LoadBalancer     Service     JobManager   UI   LB     kubectl patch service flink jobmanager  p    spec    type   LoadBalancer         kubectl delete  f flink yaml                              kubectl       n",
        "objectID": "bigdata-ai/flink-on-kubernetes/session-cluster",
        "weight": 22,
        "state": "Alpha"
    },
    {
        "title": "集群方案",
        "uri": "cluster",
        "content": "children depth 3",
        "objectID": "cluster",
        "weight": 3,
        "chapter": true,
        "hidden": true
    },
    {
        "title": "Ingress 方案",
        "uri": "cluster/ingress",
        "content": "",
        "objectID": "cluster/ingress"
    },
    {
        "title": "Nginx Ingress",
        "uri": "cluster/ingress/nginx",
        "content": "",
        "objectID": "cluster/ingress/nginx"
    },
    {
        "title": "安装 nginx ingress controller",
        "uri": "cluster/ingress/nginx/install-nginx-ingress",
        "content": "ingress               LoadBalancer     Service                          ingress                 ingress                         IP                LoadBalancer     Service           k8s                        cloud provider           LoadBalancer     Service                                                                                                 MetalLB   Porter          LoadBalancer     Service       helm    helm install stable nginx ingress     name nginx     namespace kube system     set controller ingressClass nginx     set controller publishService enabled true   controller ingressClass      ingress     kubernetes io ingress class    annotation                nginx ingress controller               controller publishService enabled       true        ingress                                           ingress controller         ip    ingress   address                   IP       nginx ingress controller   service   EXTERNAL IP        kubectl  n kube system service nginx nginx ingress controller NAME TYPE CLUSTER IP EXTERNAL IP PORT S  AGE nginx nginx ingress controller LoadBalancer 172 16 255 194 119 28 123 174 80 32348 TCP 443 32704 TCP 10m                       helm      release          controller ingressClass              ingress   kubernetes io ingress class annotation                            controller        controller replicaCount         HPA        controller autoscaling enabled    true                                     values yaml        nginx ingress        values yaml  helm inspect values stable nginx ingress   values yaml    values yaml         helm install         set                 f values yaml        nginx ingress                                       preStopHook   readinessProbe             nginx ingress      readinessProbe   preStop            values yaml   controller lifecycle    preStop     lifecycle  preStop  exec  command     bin bash     c    sleep 30                       controller affinity       affinity  podAntiAffinity  requiredDuringSchedulingIgnoredDuringExecution  weight  100 labelSelector  matchExpressions  key  app operator  values  nginx ingress key  component operator  values  controller key  release operator  values  nginx topologyKey  kubernetes io hostname      Github     https   github com kubernetes ingress nginx helm hub     https   hub helm sh charts nginx nginx ingress       https   kubernetes github io ingress nginx user guide nginx configuration",
        "objectID": "cluster/ingress/nginx/install-nginx-ingress"
    },
    {
        "title": "Traefik Ingress",
        "uri": "cluster/ingress/traefik",
        "content": "",
        "objectID": "cluster/ingress/traefik"
    },
    {
        "title": "安装 traefik ingress controller",
        "uri": "cluster/ingress/traefik/install-traefik-ingress",
        "content": "ingress               LoadBalancer     Service                          ingress                 ingress                         IP                LoadBalancer     Service           k8s                        cloud provider           LoadBalancer     Service                                                                                                 MetalLB   Porter          LoadBalancer     Service       helm    helm install stable traefik     name traefik     namespace kube system     set kubernetes ingressClass traefik     set kubernetes ingressEndpoint useDefaultPublishedService true     set rbac enabled true kubernetes ingressClass traefik      ingress     kubernetes io ingress class    annotation                traefik ingress controller               kubernetes ingressEndpoint useDefaultPublishedService true       true        ingress                                           ingress controller         ip    ingress   address   rbac enabled     false         default   service account                true      rbac         Github     https   github com containous traefik helm hub     https   hub helm sh charts stable traefik       https   docs traefik io",
        "objectID": "cluster/ingress/traefik/install-traefik-ingress"
    },
    {
        "title": "Metrics 方案",
        "uri": "cluster/metrics",
        "content": "",
        "objectID": "cluster/metrics"
    },
    {
        "title": "安装 metrics server",
        "uri": "cluster/metrics/install-metrics-server",
        "content": "yaml        git clone   depth 1 https   github com kubernetes sigs metrics server git cd metrics server    deploy 1 8  metrics server deployment yaml   args       kubelet insecure tls     metrics server    kubelet            x509  certificate signed unknown authority   containers  name  metrics server image  k8s gcr io metrics server amd64 v0 3 6 args    cert dir  tmp   secure port 4443   kubelet insecure tls                kubectl apply  f deploy 1 8        Github     https   github com kubernetes sigs metrics server",
        "objectID": "cluster/metrics/install-metrics-server"
    },
    {
        "title": "网络方案",
        "uri": "cluster/network",
        "content": "",
        "objectID": "cluster/network"
    },
    {
        "title": "Flannel",
        "uri": "cluster/network/flannel",
        "content": "",
        "objectID": "cluster/network/flannel"
    },
    {
        "title": "部署 Flannel",
        "uri": "cluster/network/flannel/deploy",
        "content": "CLUSTER_CIDR  CLUSTER_CIDR 10 10 0 0 16    flannel       cat          flannel     https   raw githubusercontent com coreos flannel master Documentation kube flannel yml       CLUSTER_CIDR",
        "objectID": "cluster/network/flannel/deploy"
    },
    {
        "title": "彻底理解集群网络",
        "uri": "cluster/network/understanding",
        "content": "TODO K8S      TODO      K8S      TODO     K8S              TODO CNI    TODO        TODO      Cluster Networking  https   kubernetes io docs concepts cluster administration networking",
        "objectID": "cluster/network/understanding"
    },
    {
        "title": "运行时方案",
        "uri": "cluster/runtime",
        "content": "",
        "objectID": "cluster/runtime"
    },
    {
        "title": "Containerd",
        "uri": "cluster/runtime/containerd",
        "content": "",
        "objectID": "cluster/runtime/containerd"
    },
    {
        "title": "安装 containerd",
        "uri": "cluster/runtime/containerd/install-containerd",
        "content": "wget  q   show progress   https only   timestamping   https   github com opencontainers runc releases download v1 0 0 rc8 runc amd64   https   github com containerd containerd releases download v1 3 0 containerd 1 3 0 linux amd64 tar gz   https   github com kubernetes sigs cri tools releases download v1 16 1 crictl v1 16 1 linux amd64 tar gz sudo mv runc amd64 runc        tar  xvf crictl v1 16 1 linux amd64 tar gz chmod  x crictl runc sudo cp crictl runc  usr local bin  mkdir containerd tar  xvf containerd 1 3 0 linux amd64 tar gz  C containerd sudo cp containerd bin    bin     containerd      config toml  sudo mkdir  p  etc containerd  cat   EOF   sudo tee  etc containerd config toml  plugins   plugins cri containerd  snapshotter    overlayfs   plugins cri containerd default_runtime  runtime_type    io containerd runtime v1 linux  runtime_engine     usr local bin runc  runtime_root      EOF    systemd    containerd service  cat",
        "objectID": "cluster/runtime/containerd/install-containerd"
    },
    {
        "title": "配置管理",
        "uri": "configuration",
        "content": "",
        "objectID": "configuration",
        "weight": 16,
        "state": "TODO"
    },
    {
        "title": "使用 Helm 管理集群资源",
        "uri": "configuration/helm",
        "content": "children",
        "objectID": "configuration/helm",
        "state": "Alpha"
    },
    {
        "title": "Helm 常见问题",
        "uri": "configuration/helm/helm-faq",
        "content": "helm 3      stable repo              helm repo add stable https   kubernetes charts storage googleapis com             mirror  helm repo add stable https   apphub aliyuncs com stable",
        "objectID": "configuration/helm/helm-faq",
        "weight": 4
    },
    {
        "title": "安装 Helm",
        "uri": "configuration/helm/install-helm",
        "content": "Helm   Kubernetes               kubernetes                         kubectl                   Helm            V2 Helm V3                       Helm V2        helm        curl https   raw githubusercontent com kubernetes helm master scripts get   bash   Total   Received   Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 6737 100 6737 0 0 12491 0                            12475 Downloading https   kubernetes helm storage googleapis com helm v2 9 1 linux amd64 tar gz Preparing install  usr local bin helm installed  usr local bin helm Run  helm init  configure helm             helm version Client   version Version SemVer  v2 9 1   GitCommit  20adb27c7c5868466912eebdf6664e7390ebe710   GitTreeState  clean      tiller      kubernetes       helm init Creating  root  helm Creating  root  helm repository Creating  root  helm repository cache Creating  root  helm repository local Creating  root  helm plugins Creating  root  helm starters Creating  root  helm cache archive Creating  root  helm repository repositories yaml Adding stable repo URL  https   kubernetes charts storage googleapis com Adding local repo URL  http   127 0 0 1 8879 charts  HELM_HOME configured  root  helm  Tiller  the Helm server side component  installed Kubernetes Cluster  Please note  default  Tiller deployed insecure  allow unauthenticated users  policy  information securing installation see  https   docs helm sh using_helm  securing your helm installation Happy Helming     tiller           kubectl pods   namespace kube system   grep tiller tiller deploy dccdb6fd9 2df4r 0 1 ImagePullBackOff 0 14h       ImagePullBackOff                             gcr io                      kubectl describe pod tiller deploy dccdb6fd9 2df4r   namespace kube system Events  Type Reason Age Message                               Warning Failed 36m  x5 12h  kubelet  k8s node1 Failed pull image  gcr io kubernetes helm tiller v2 9 1   rpc error  code   Unknown desc   https   gcr io v1 _ping  dial tcp 64 233 189 82 443  i o timeout Normal BackOff 11m  x3221 14h  kubelet  k8s node1 Back off pulling image  gcr io kubernetes helm tiller v2 9 1  Warning Failed 6m  x3237 14h  kubelet  k8s node1 Error  ImagePullBackOff Warning Failed 1m  x15 14h  kubelet  k8s node1 Failed pull image  gcr io kubernetes helm tiller v2 9 1   rpc error  code   Unknown desc   https   gcr io v1 _ping  dial tcp 64 233 188 82 443  i o timeout                               Running    tiller            kubectl pods  n kube system   grep tiller tiller deploy dccdb6fd9 2df4r 1 1 Running 1 41d       tiller                                 helm         namespace    kubectl create serviceaccount   namespace kube system tiller kubectl create clusterrolebinding tiller cluster rule   clusterrole cluster admin   serviceaccount kube system tiller kubectl patch deploy   namespace kube system tiller deploy  p    spec    template    spec    serviceAccount   tiller                 https   helm sh docs using _helm   quickstart guide    Helm V3   https   github com helm helm releases                    v3 0 0 beta 3   linux amd64      wget https   get helm sh helm v3 0 0 beta 3 linux amd64 tar gz        PATH       tar  zxvf helm v3 0 0 beta 3 linux amd64 tar gz linux amd64  linux amd64 LICENSE linux amd64 helm linux amd64 README md   cd linux amd64    ls LICENSE README md helm   mv helm  usr local bin helm3",
        "objectID": "configuration/helm/install-helm",
        "weight": 2
    },
    {
        "title": "Helm V2 迁移到 V3",
        "uri": "configuration/helm/upgrade-helm-v2-to-v3",
        "content": "Helm V3   V2                             helm 2to3                           Helm V2   V3          Helm V3                    2to3            helm3 plugin install https   github com helm helm 2to3 Downloading installing helm 2to3 v0 1 1     https   github com helm helm 2to3 releases download v0 1 1 helm 2to30 1 1linux_amd64 tar gz Installed plugin  2to3               helm3 plugin list NAME VERSION DESCRIPTION 2to3 0 1 1 migrate Helm v2 configuration releases in place Helm v3    Helm V2      helm3 2to3 move config  Helm 2  Home directory   root  helm  Helm 3  Config directory   root  config helm  Helm 3  Data directory   root  local share helm  Helm 3  Create config folder   root  config helm     Helm 3  Config folder   root  config helm  created   Helm 2  repositories file   root  helm repository repositories yaml  will copy  Helm 3  config folder   root  config helm repositories yaml     Helm 2  repositories file   root  helm repository repositories yaml  copied successfully  Helm 3  config folder   root  config helm repositories yaml     Helm 3  Create data folder   root  local share helm     Helm 3  data folder   root  local share helm  created   Helm 2  plugins   root  helm plugins  will copy  Helm 3  data folder   root  local share helm plugins     Helm 2  plugins   root  helm plugins  copied successfully  Helm 3  data folder   root  local share helm plugins     Helm 2  starters   root  helm starters  will copy  Helm 3  data folder   root  local share helm starters     Helm 2  starters   root  helm starters  copied successfully  Helm 3  data folder   root  local share helm starters                Chart    Helm    Chart starters     repo   plugin    helm3 repo list NAME URL stable https   kubernetes charts storage googleapis com local http   127 0 0 1 8879 charts       helm3 plugin list NAME VERSION DESCRIPTION 2to3 0 1 1 migrate Helm v2 configuration releases in place Helm v3 push 0 1 1 Push chart package TencentHub    Heml V2 Release     Helm V2            2to3   convert        V3             helm3 2to3 convert   help migrate Helm v2 release in place Helm v3 Usage  2to3 convert  flags  RELEASE Flags    delete v2 releases v2 releases deleted migration  default  v2 releases retained   dry run simulate convert  h    help help convert  l    label string label select tiller resources  default  OWNER TILLER    s    release storage string v2 release storage type object   secrets   configmaps   used  tiller out cluster  flag  default  secrets    t    tiller ns string namespace Tiller  default  kube system     tiller out cluster when Tiller not running cluster e g  Tillerless   tiller out cluster       Helm V2   tiller         tillerless                   dry run                                                        tiller ns     tiller               kube system                 helm v2   release    helm ls NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE redis 1 Mon Sep 16 14 46 58 2019 DEPLOYED redis 9 1 3 5 0 5 default        dry run         helm3 2to3 convert redis   dry run NOTE  dry run mode  following actions will not executed  Run without   dry run actions described below  Release  redis  will converted Helm 2 Helm 3   Helm 3  Release  redis  will created   Helm 3  ReleaseVersion  redis v1  will created            dry run         helm3 2to3 convert redis Release  redis  will converted Helm 2 Helm 3   Helm 3  Release  redis  will created   Helm 3  ReleaseVersion  redis v1  will created   Helm 3  ReleaseVersion  redis v1  created   Helm 3  Release  redis  created  Release  redis  converted successfully Helm 2 Helm 3  Note  v2 releases remain removed avoid conflicts migrated v3 releases            helm ls NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE redis 1 Mon Sep 16 14 46 58 2019 DEPLOYED redis 9 1 3 5 0 5 default       helm3 ls  a NAME NAMESPACE REVISION UPDATED STATUS CHART redis default 1 2019 09 16 06 46 58 541391356  0000 UTC deployed redis 9 1 3 helm 3   release             a             release      migrate Helm v2 Helm v3  https   helm sh blog migrate from helm v2 to helm v3",
        "objectID": "configuration/helm/upgrade-helm-v2-to-v3",
        "weight": 3
    },
    {
        "title": "部署指南",
        "uri": "deploy",
        "content": "children depth 3",
        "objectID": "deploy",
        "weight": 10
    },
    {
        "title": "附加组件",
        "uri": "deploy/addons",
        "content": "children",
        "objectID": "deploy/addons",
        "weight": 40,
        "state": "Alpha"
    },
    {
        "title": "部署 CoreDNS",
        "uri": "deploy/addons/coredns",
        "content": "git clone https   github com coredns deployment git   cd deployment kubernetes   ls CoreDNS k8sversion md FAQs md README md ScalingCoreDNS md Upgrading_CoreDNS md coredns yaml sed corefile tool deploy sh migration rollback sh           help      deploy sh  h usage    deploy sh    r REVERSE CIDR      i DNS IP      d CLUSTER DOMAIN      t YAML TEMPLATE    r   Define reverse zone given CIDR  may specifcy option once add multiple reverse zones  no reverse CIDRs defined  default handle reverse zones  i e  in addr arpa ip6 arpa   i   Specify cluster DNS IP address  not specificed  IP address existing  kube dns  service used  present   s   Skips translation kube dns configmap corresponding CoreDNS Corefile configuration               deploy sh    yaml      coredns yaml       kubectl apply  f coredns yaml                kubectl delete  f coredns yaml  deploy sh      jq          jq      apt install  y jq              kube dns      coredns        i        DNS   CLUSTER IP    IP                   deploy sh  i 10 32 0 255   coredns yaml kubectl apply  f coredns yaml",
        "objectID": "deploy/addons/coredns"
    },
    {
        "title": "以 Daemonset 方式部署 kube-proxy",
        "uri": "deploy/addons/kube-proxy",
        "content": "kube proxy               kubelet     Pod           DaemonSet         ServiceAccount   token                                       APISERVER  https   10 200 16 79 6443  CLUSTER_CIDR  10 10 0 0 16  APISERVER     apiserver                                kubernetes default      CLUSTER IP                  CLSUTER IP       kube proxy     iptables   ipvs      Service    Endpoint   Pod IP kube proxy                         kube proxy      apiserver    Service   Endpoint            kube proxy    apiserver   CLUSTER IP           apiserver  CLUSTER_CIDR       Pod IP   CIDR          kube controller manager         kube proxy    RBAC          cat",
        "objectID": "deploy/addons/kube-proxy"
    },
    {
        "title": "附录",
        "uri": "deploy/appendix",
        "content": "",
        "objectID": "deploy/appendix",
        "weigth": 50
    },
    {
        "title": "安装 kubectl",
        "uri": "deploy/appendix/install-kubectl",
        "content": "K8S     cpu    VERSION  v1 16 1  ARCH  amd64        wget  q   show progress   https only   timestamping   https   storage googleapis com kubernetes release release   VERSION  bin linux   ARCH  kubectl chmod  x kubectl mv kubectl  usr local bin",
        "objectID": "deploy/appendix/install-kubectl"
    },
    {
        "title": "使用 kubespray 部署",
        "uri": "deploy/kubespray",
        "content": "",
        "objectID": "deploy/kubespray",
        "weight": 20,
        "state": "TODO"
    },
    {
        "title": "手工部署",
        "uri": "deploy/manual",
        "content": "kubernetes 1 16 1 containerd 1 3 0 coredns v1 6 2 cni v0 8 2 flannel v0 11 0 etcd v3 4 1     kubelet           kube proxy   daemonset                         docker      containerd    dockerd     bug                  ETCD    Master    Worker",
        "objectID": "deploy/manual",
        "weight": 20,
        "state": "Beta"
    },
    {
        "title": "部署 ETCD",
        "uri": "deploy/manual/bootstrapping-etcd",
        "content": "ETCD                     etcd               cat   etcd csr json hosts      etcd             IP               etcd key pem  kube apiserver      etcd pem  kube apiserver         ETCD    release    wget  q   show progress   https only   timestamping    https   github com etcd io etcd releases download v3 4 1 etcd v3 4 1 linux amd64 tar gz       etcd   etcdctl   PATH  tar  xvf etcd v3 4 1 linux amd64 tar gz sudo mv etcd v3 4 1 linux amd64 etcd   usr local bin                      sudo mkdir  p  etc etcd  var lib etcd sudo cp ca pem etcd key pem etcd pem  etc etcd  etcd                          infra0        infra1                 hostname  NAME infra0       ETCD        IP   INTERNAL_IP  INTERNAL_IP 10 200 16 79     ETCD              https       ETCD_SERVERS      2380       2379   ETCD_SERVERS  infra0 https   10 200 16 79 2380 infra1 https   10 200 17 6 2380 infra2 https   10 200 16 70 2380     systemd     cat",
        "objectID": "deploy/manual/bootstrapping-etcd",
        "weight": 2
    },
    {
        "title": "部署 Master",
        "uri": "deploy/manual/bootstrapping-master",
        "content": "Master                            Master                           CA         CA                       cfssl                      kube apiserver      kube apiserver   k8s          K8S       kubectl        kube apiserver      tls               kube apiserver             client    kube apiserver              Pod      kube apiserver   Service          Service      kubernetes kubernetes default kubernetes default svc kubernetes default svc cluster kubernetes default svc cluster local            kube apiserver      kubectl               kube apiserver            Promethues                        kube apiserver          127 0 0 1    Master        127 0 0 1      kube apiserver Service CIDR      IP    flanneld   daemonset            hostNetwork                service      apiserver      hostNetwork      service         DNS      DNS       apiserver     CLUSTER IP     apiserver  kube controller manager     service cluster ip range       10 32 0 0 16       IP    10 32 0 1           DNS        kube apiserver           LB IP     Master                      LB IP     kube apiserver Master    IP       Master                 kubectl      Master    IP    kube apiserver    CSR     cat   apiserver csr json hosts                      Master    IP                          apiserver csr json     hosts       cfssl gencert    ca ca pem    ca key ca key pem    config ca config json    profile kubernetes   apiserver csr json   cfssljson  bare apiserver               apiserver key pem  kube apiserver      apiserver pem  kube apiserver      kube controller manager      cat   kube controller manager csr json cat   kube scheduler csr json kube controller manager           service account    token             https   kubernetes io docs reference access authn authz service accounts admin  cat   service account csr json             cat   admin csr json    Master     kubeconfig               kubeconfig      Master         kubeconfig              apiserver          apiserver    client     CA                   kubeconfig                 kubectl       kubeconfig    kubectl         kubeconfig                                       apiserver               apiserver            apiserver               master                   127 0 0 1    IP   apiserver     master         apiserver              apiserver         IP                   apiserver                                      IP         kube apiserver        hosts            APISERVER        apiserver                                     APISERVER  https   10 200 16 79 6443    kube controller manager    kubeconfig APISERVER  https   10 200 16 79 6443  kubectl config set cluster roc     certificate authority ca pem     embed certs true     server   APISERVER      kubeconfig kube controller manager kubeconfig kubectl config set credentials system kube controller manager     client certificate kube controller manager pem     client key kube controller manager key pem     embed certs true     kubeconfig kube controller manager kubeconfig kubectl config set context default     cluster roc     user system kube controller manager     kubeconfig kube controller manager kubeconfig kubectl config use context default   kubeconfig kube controller manager kubeconfig       kube controller manager kubeconfig   kube scheduler    kubeconfig APISERVER  https   10 200 16 79 6443  kubectl config set cluster roc     certificate authority ca pem     embed certs true     server   APISERVER      kubeconfig kube scheduler kubeconfig kubectl config set credentials system kube scheduler     client certificate kube scheduler pem     client key kube scheduler key pem     embed certs true     kubeconfig kube scheduler kubeconfig kubectl config set context default     cluster roc     user system kube scheduler     kubeconfig kube scheduler kubeconfig kubectl config use context default   kubeconfig kube scheduler kubeconfig       kube scheduler kubeconfig        kubeconfig          kubeconfig      kubectl        APISERVER  https   10 200 16 79 6443  kubectl config set cluster roc     certificate authority ca pem     embed certs true     server   APISERVER      kubeconfig admin kubeconfig kubectl config set credentials admin     client certificate admin pem     client key admin key pem     embed certs true     kubeconfig admin kubeconfig kubectl config set context default     cluster roc     user admin     kubeconfig admin kubeconfig kubectl config use context default   kubeconfig admin kubeconfig       admin kubeconfig   admin kubeconfig        kubectl         kube config         kubectl    kubeconfig          kubectl         kubeconfig      mv admin kubeconfig    kube config           wget  q   show progress   https only   timestamping   https   storage googleapis com kubernetes release release v1 16 1 bin linux amd64 kube apiserver   https   storage googleapis com kubernetes release release v1 16 1 bin linux amd64 kube controller manager   https   storage googleapis com kubernetes release release v1 16 1 bin linux amd64 kube scheduler chmod  x kube apiserver kube controller manager kube scheduler mv kube apiserver kube controller manager kube ",
        "objectID": "deploy/manual/bootstrapping-master",
        "weight": 3
    },
    {
        "title": "部署 Worker 节点",
        "uri": "deploy/manual/bootstrapping-worker-nodes",
        "content": "Worker        kubelet             Master            Worker                 sudo apt get update sudo apt get  y install socat conntrack ipset    Swap             swap kubelet       k8s        swap            sudo swapon   show               swap           swap  sudo swapoff  a            swap          etc fstab         sudo sed  i    swap   s            1 g   etc fstab    SELinux    SELinux      K8S           Permission denied  sudo setenforce 0              sudo sed  i  s SELINUX enforcing SELINUX disabled g   etc selinux config      sudo mkdir  p    etc cni net d    opt cni bin    var lib kubelet    var lib kubernetes    var run kubernetes                wget  q   show progress   https only   timestamping   https   github com opencontainers runc releases download v1 0 0 rc8 runc amd64   https   github com containerd containerd releases download v1 3 0 containerd 1 3 0 linux amd64 tar gz   https   github com kubernetes sigs cri tools releases download v1 16 1 crictl v1 16 1 linux amd64 tar gz   https   github com containernetworking plugins releases download v0 8 2 cni plugins linux amd64 v0 8 2 tgz   https   storage googleapis com kubernetes release release v1 16 1 bin linux amd64 kubelet sudo mv runc amd64 runc        chmod  x crictl kubelet runc tar  xvf crictl v1 16 1 linux amd64 tar gz mkdir containerd tar  xvf containerd 1 3 0 linux amd64 tar gz  C containerd sudo cp crictl kubelet runc  usr local bin  sudo cp containerd bin    bin  sudo tar  xvf cni plugins linux amd64 v0 8 2 tgz  C  opt cni bin        containerd    containerd      config toml  sudo mkdir  p  etc containerd  cat 11m v1 16 1                NotReady   node kubernetes io not ready NoSchedule                Pod                     Daemonset       hostNetwork              kubelet server           RBAC    kubelet    CSR            kubelet         client   server     CSR            client     CSR    kube controller manager              kubelet       client                var lib kubelet pki           client     ls  l  var lib kubelet pki total 4  rw        1 root root 1277 Oct 10 20 46 kubelet client 2019 10 10 20 46 23 pem lrwxrwxrwx 1 root root 59 Oct 10 20 46 kubelet client current pem     var lib kubelet pki kubelet client 2019 10 10 20 46 23 pem   kubeconfig        kubelet client current pem              bundle                  server                                       CSR    kubectl csr NAME AGE REQUESTOR CONDITION csr 6gkn6 2m4s system bootstrap 360483 Approved Issued csr vf285 103s system node 10 200 17 6 Pending        system bootstrap        CSR        approve              kubelet    bootstrap token      system bootstrappers              RBAC           approve CSR        system node        CSR       Pending        approve    kubectl certificate approve csr vf285 certificatesigningrequest certificates k8s io csr vf285 approved   ls  l  var lib kubelet pki total 8  rw        1 root root 1277 Oct 10 20 46 kubelet client 2019 10 10 20 46 23 pem lrwxrwxrwx 1 root root 59 Oct 10 20 46 kubelet client current pem     var lib kubelet pki kubelet client 2019 10 10 20 46 23 pem  rw        1 root root 1301 Oct 10 21 09 kubelet server 2019 10 10 21 09 15 pem lrwxrwxrwx 1 root root 59 Oct 10 21 09 kubelet server current pem     var lib kubelet pki kubelet server 2019 10 10 21 09 15 pem     client      kubelet server current pem          bundle                   kubelet    10250",
        "objectID": "deploy/manual/bootstrapping-worker-nodes",
        "weight": 4
    },
    {
        "title": "部署关键组件",
        "uri": "deploy/manual/deploy-critical-addons",
        "content": "kube proxy kube proxy     apiserver    Service    Endpoint   Service   ClUSTER IP     Endpoint   Pod IP         iptables   ipvs            Service              Daemonset      kube proxy              Flannel      DNS    DNS   Kubernetes                          Pod   DNS           service        CLUSTER IP    headless service       Pod IP       endpoint   Pod IP               Pod      DNS         kube dns   CoreDNS                       CoreDNS                        CoreDNS",
        "objectID": "deploy/manual/deploy-critical-addons",
        "weight": 5
    },
    {
        "title": "部署前的准备工作",
        "uri": "deploy/manual/prepare",
        "content": "Linux            Ubuntu 18 04    Master       K8S                   ETCD       ETCD     Master                                Worker                Master         Worker         kubelet      kube reserved                    Master            Pod    Master          DNS                   cfssl   kubectl             kubeconfig                         cfssl curl  L https   pkg cfssl org R1 2 cfssl_linux amd64  o cfssl curl  L https   pkg cfssl org R1 2 cfssljson_linux amd64  o cfssljson curl  L https   pkg cfssl org R1 2 cfssl certinfo_linux amd64  o cfssl certinfo chmod  x cfssl cfssljson cfssl certinfo sudo mv cfssl cfssljson cfssl certinfo  usr local bin     kubectl wget  q   show progress   https only   timestamping   https   storage googleapis com kubernetes release release v1 16 1 bin linux amd64 kubectl chmod  x kubectl mv kubectl  usr local bin     CA                       CA                    CA                cat   ca csr json ca config json       CA                               client            client       CA           CA     CN   O                      CN   O",
        "objectID": "deploy/manual/prepare",
        "weight": 1
    },
    {
        "title": "方案选型",
        "uri": "deploy/selection",
        "content": "",
        "objectID": "deploy/selection",
        "weight": 10,
        "state": "TODO"
    },
    {
        "title": "开发指南",
        "uri": "dev",
        "content": "",
        "objectID": "dev",
        "weight": 100,
        "state": "Alpha"
    },
    {
        "title": "使用 client-go 开发 k8s 应用",
        "uri": "dev/client-go",
        "content": "",
        "objectID": "dev/client-go",
        "state": "TODO"
    },
    {
        "title": "Go 语言编译原理与优化",
        "uri": "dev/golang-build",
        "content": "Compilation  debug     m               gcflags   m   S       gcflags   S                     debug                                   gcflags   N  l         gcflags   l  l      2                          gcflags   l  l  l      3                             bug   gcflags  l 4  4  l   Go 1 11                                                               new make                                                                                           Linking  Go    internal   external         internal    go       linker external         linker linker          o  object file                     go tool link        GOROOT src cmd link     ldflags              go tool link   help    CGO   cgo         c  go            CGOENABLED        cgo    CGOENABLED 1    cgo         build tag     cgo                  build cgo     cgo                build  cgo                      GOROOT src os user lookupunix go    GOROOT src os user cgolookup_unix go                      go        cgo                cgo       net    internal linking link      internal         go        linker                     o        a             a     GOROOT pkg    GOPATH pkg        o            tar  zxvf           external linking       linker  gcc clang      ldflags   linkmode  external      external linking     extldflags     linker         ldflags   linkmode  external   extldflags   static   static link go              runtime                                                                           external linking        ldflags   linkmode external  extldflags  static         internal linking        ldflags   d  ldflags         s  w        DWARF                                     ldflags   s  w   X                            commit id               version                             ldflags   X myapp pkg version version v1 0 0     Docker       Docker            go                                       run                                                  cfssl    ROOT_PKG github com cloudflare cfssl CMDPKG  ROOTPKG cmd LOCALSOURCEPATH  Users roc go src  ROOT_PKG LOCALOUTPUTPATH  PWD GOPATH  go src ROOTPATH  GOPATH  ROOTPKG CMDPATH  GOPATH  CMDPKG docker run   rm    v  LOCALSOURCEPATH  ROOT_PATH    v  LOCALOUTPUTPATH  output    w  ROOT_PATH   golang 1 13   go build  v    ldflags   d     o  output     CMD_PATH                    docker                      golang 1 12 stretch builder MAINTAINER rockerchen tencent com ENV BUILDDIR  go src cloud tencent com qccontainer_cluster hpa metrics server WORKDIR  BUILD_DIR COPY     BUILD_DIR RUN CGO_ENABLED 0 go build  v  o  hpa metrics server    ldflags   d       ubuntu 16 04 MAINTAINER rockerchen tencent com RUN apt get update  y RUN DEBIAN_FRONTEND noninteractive apt get install  y curl iproute2 inetutils tools telnet inetutils ping RUN apt get install   no install recommends   no install suggests ca certificates  y COPY   from builder  hpa metrics server  hpa metrics server RUN chmod a x  hpa metrics server      Go                https   segmentfault com a 1190000016354799",
        "objectID": "dev/golang-build",
        "state": "Alpha"
    },
    {
        "title": "Ingress 指南",
        "uri": "ingress",
        "content": "",
        "objectID": "ingress",
        "weight": 12,
        "state": "TODO"
    },
    {
        "title": "Ingress 方案选型",
        "uri": "ingress/choose",
        "content": "",
        "objectID": "ingress/choose",
        "weight": 20,
        "state": "TODO"
    },
    {
        "title": "Nginx Ingress",
        "uri": "ingress/nginx-ingress",
        "content": "",
        "objectID": "ingress/nginx-ingress",
        "weight": 30
    },
    {
        "title": "安装 nginx ingress controller",
        "uri": "ingress/nginx-ingress/install-nginx-ingress",
        "content": "ingress               LoadBalancer     Service                          ingress                 ingress                         IP                LoadBalancer     Service           k8s                        cloud provider           LoadBalancer     Service                                                                                                 MetalLB   Porter          LoadBalancer     Service       helm    helm install stable nginx ingress     name nginx     namespace kube system     set controller ingressClass nginx     set controller publishService enabled true   controller ingressClass      ingress     kubernetes io ingress class    annotation                nginx ingress controller               controller publishService enabled       true        ingress                                           ingress controller         ip    ingress   address                   IP       nginx ingress controller   service   EXTERNAL IP        kubectl  n kube system service nginx nginx ingress controller NAME TYPE CLUSTER IP EXTERNAL IP PORT S  AGE nginx nginx ingress controller LoadBalancer 172 16 255 194 119 28 123 174 80 32348 TCP 443 32704 TCP 10m                       helm      release          controller ingressClass              ingress   kubernetes io ingress class annotation                            controller        controller replicaCount         HPA        controller autoscaling enabled    true                                     values yaml        nginx ingress        values yaml  helm inspect values stable nginx ingress   values yaml    values yaml         helm install         set                 f values yaml        nginx ingress                                       preStopHook   readinessProbe             nginx ingress      readinessProbe   preStop            values yaml   controller lifecycle    preStop     lifecycle  preStop  exec  command     bin bash     c    sleep 30                       controller affinity       affinity  podAntiAffinity  requiredDuringSchedulingIgnoredDuringExecution  weight  100 labelSelector  matchExpressions  key  app operator  values  nginx ingress key  component operator  values  controller key  release operator  values  nginx topologyKey  kubernetes io hostname      Github     https   github com kubernetes ingress nginx helm hub     https   hub helm sh charts nginx nginx ingress       https   kubernetes github io ingress nginx user guide nginx configuration",
        "objectID": "ingress/nginx-ingress/install-nginx-ingress"
    },
    {
        "title": "Traefik Ingress",
        "uri": "ingress/traefik-ingress",
        "content": "",
        "objectID": "ingress/traefik-ingress",
        "weight": 40
    },
    {
        "title": "安装 traefik ingress controller",
        "uri": "ingress/traefik-ingress/install-traefik-ingress",
        "content": "ingress               LoadBalancer     Service                          ingress                 ingress                         IP                LoadBalancer     Service           k8s                        cloud provider           LoadBalancer     Service                                                                                                 MetalLB   Porter          LoadBalancer     Service       helm              https   docs traefik io getting started install traefik      notice info     traefik       Helm Chart   v1 x     stable traefik  v2 x   chart             notice         traefik        chart      traefik v1 x              helm install stable traefik     name traefik     namespace kube system     set kubernetes ingressClass traefik     set kubernetes ingressEndpoint useDefaultPublishedService true     set rbac enabled true           helm install traefik stable traefik     namespace kube system     set kubernetes ingressClass traefik     set kubernetes ingressEndpoint useDefaultPublishedService true     set rbac enabled true            kubernetes ingressClass traefik      ingress     kubernetes io ingress class    annotation                traefik ingress controller               kubernetes ingressEndpoint useDefaultPublishedService true       true        ingress                                           ingress controller         ip    ingress   address        kubectl ingress                rbac enabled     false         default   service account                true      rbac               traefik v2 x     chart             git clone   depth 1 https   github com containous traefik helm chart git kubectl apply  f traefik helm chart traefik crds helm repo add traefik https   containous github io traefik helm chart helm repo update helm install traefik traefik     name traefik     namespace kube system           helm repo add traefik https   containous github io traefik helm chart helm repo update helm install traefik traefik traefik     namespace kube system     set ports web port 80     set ports websecure port 443     set  additionalArguments    providers kubernetesingress                   Github     https   github com containous traefik helm hub     https   hub helm sh charts stable traefik       https   docs traefik io",
        "objectID": "ingress/traefik-ingress/install-traefik-ingress",
        "weight": 20
    },
    {
        "title": "使用 Traefik V2 让你的后台管理页面支持登录",
        "uri": "ingress/traefik-ingress/use-traefik-to-support-login",
        "content": "kubectl proxy                     Traefik                  basic auth                   USERNAME roc PASSWORD mypassword    Secret  USERS   htpasswd  nb USERNAME PASSWORD  cat",
        "objectID": "ingress/traefik-ingress/use-traefik-to-support-login",
        "weight": 30
    },
    {
        "title": "彻底理解 Ingress",
        "uri": "ingress/understand",
        "content": "",
        "objectID": "ingress/understand",
        "weight": 10,
        "state": "TODO"
    },
    {
        "title": "日志收集",
        "uri": "log",
        "content": "",
        "objectID": "log",
        "weight": 44,
        "state": "TODO"
    },
    {
        "title": "利用 Loki/Promtail/Grafana 收集分析日志",
        "uri": "log/loki-stack",
        "content": "Loki Promtail Grafana vs EFK Loki Stack         Loki      EFK    ElasticSearch           Promtail      EFK    Filebeat Fluentd           Grafana      EFK    Kibana    UI       Helm    Loki Stack   Kubernetes           https   github com grafana loki blob master docs installation helm md loki loki stack    chart    loki stack          loki    Statefulset            promtail    Daemonset                      loki grafana                 grafana          grafana                   grafana      repo  helm repo add loki https   grafana github io loki charts helm repo update                  helm upgrade   install loki loki loki stack           helm upgrade   install loki loki loki stack  n monitoring     loki        loki         helm upgrade   install loki loki loki stack   set  loki persistence enabled ture loki persistence size 100G     grafana helm upgrade   install loki loki loki stack   set  grafana true            helm install loki loki loki stack           helm install loki loki loki stack  n monitoring     loki        loki         helm install loki loki loki stack   set  loki persistence enabled ture loki persistence size 100G     grafana helm install loki loki loki stack   set  grafana enabled true                grafana       loki       Configuration Data Sources Add data source Loki      loki             http   loki monitoring svc cluster local 3100                           Explore      loki          Logs       Metrics       Log labels          label",
        "objectID": "log/loki-stack",
        "weight": 20,
        "state": "Alpha",
        "LastModifierDisplayName": "roc",
        "LastModifierURL": "https://imroc.io",
        "date": "2020-03-12T00:00:00.000Z"
    },
    {
        "title": "Metrics 指南",
        "uri": "metrics",
        "content": "",
        "objectID": "metrics",
        "weight": 13,
        "state": "TODO"
    },
    {
        "title": "监控指南",
        "uri": "monitoring",
        "content": "children depth 2",
        "objectID": "monitoring",
        "weight": 43,
        "state": "Alpha",
        "chapter": true
    },
    {
        "title": "告警",
        "uri": "monitoring/alerting",
        "content": "alertmanager      dump     kubectl  n monitoring secret alertmanager main  o jsonpath    data alertmanager  yaml     base64  d   alertmanager main yaml",
        "objectID": "monitoring/alerting",
        "hidden": true
    },
    {
        "title": "打造云原生大型分布式监控系统",
        "uri": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system",
        "content": "children depth 2",
        "objectID": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system",
        "weight": 1000,
        "state": "Alpha",
        "chapter": false
    },
    {
        "title": "大规模场景下 Prometheus 的优化手段",
        "uri": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/optimize-prometheus-in-large-scale",
        "content": "Prometheus                                    Prometheus                        PromQL                                 pull                          Prometheus   metrics                Prometheus                     exporter       Prometheus               Prometheus           Prometheus                             Prometheus     Prometheus                                                                                 Prometheus                                                                                                          15                                                              Prometheus Prometheus                                 Prometheus                                       Prometheus                                                             Prometheus                  Prometheus                                                                                                                     kubelet     cadvisor                   DeamonSet node exporter                                                                pod                                                       YY                                         Prometheus                     Prometheus                                                       CPU    IO              Prometheus                                                                                                            Sharding          group     Prometheus                 group                             Prometheus                  group               kubelet cadvisor                    Kubernetes              sharding                       shard     group            Prometheus                 consul     Prometheus        consulsdconfig          Prometheus        group  job_name   cadvisor 1  consulsdconfigs  server  10 0 0 3 8500 services  cadvisor 1   2nd slave               Kubernetes   EndpointSlice                                                                        Kubernentes       1 18        Kubernetes   node          Prometheus relabel     hashmod    node        Prometheus                 job_name   cadvisor 1  metrics_path   metrics cadvisor scheme  https    kubelet metrics                 webhook     apiserver      RBAC          ServiceAccount   token bearertokenfile   var run secrets kubernetes io serviceaccount token kubernetessdconfigs  role  node       kubelet   server        x509  certificate signed unknown authority tls_config  insecureskipverify  true relabel_configs  sourcelabels   address_  modulus  4          4   group targetlabel  tmphash action  hashmod sourcelabels   tmphash  regex   1        2   group           0    1   group  action  keep                      Prometheus               Prometheus                                 Grafana                                                                                                               Prometheus                remote write           adapter        OpenTSDB   InfluxDB                Prometheus     remote_write  url  http   10 0 0 2 8888 write    Grafana                                                                                            OpenTSDB    HBase  BigTable        InfluxDB                                             PromQL                                     Prometheus                       Prometheus                    Prometheus              Prometheus                                                                    Kubernetes       cadvisor          Prometheus                 cadvisor                                                                                                                cpu         cadvisor                   Prometheus                                                         https   prometheus io docs prometheus latest federation  Prometheus                    Prometheus                 Prometheus                                               Prometheus                                                                                                 Prometheus                                                   Nginx   HAProxy   Kubernetes         Kubernentes   Service   kube proxy     iptables ipvs           Istio      VirtualService   envoy sidecar             Prometheus                     Prometheus                                                     Prometheus                     Prometheus                                           long term storage                                                                                                                                                                                                Thanos                   Prometheus API                Prometheus                                                                 Thanos",
        "objectID": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/optimize-prometheus-in-large-scale",
        "weight": 10,
        "date": "2020-03-27T00:00:00.000Z"
    },
    {
        "title": "Thanos 架构详解",
        "uri": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-arch",
        "content": "Prometheus                            Prometheus                                                                                                                            Thanos                      Prometheus                                               Thanos                        Thanos                                                  Thanos Query      Prometheus API                            client    grafana            Thanos Sidecar     Prometheus         Thanos Query                           Thanos Store Gateway              Thanos Query      Thanos Ruler                                      Thanos Query                        Thanos Compact                                                    Thanos                YY                 Prometheus            Query   Sidecar                   Prometheus            Prometheus       Prometheus                                                                                                                                                       Thanos              Thanos Query                       Prometheus   HTTP API         PromQL       Prometheus       client        Prometheus           Thanos Query Thanos Query                                   client          Prometheus           Thanos Query               Thanos          Store API     gRPC                       Thanos Query                                                  Prometheus                                           Prometheus        Sidecar    Sidecar    Thanos Store API   Thanos Query         Sidecar            Prometheus             Thanos Query     Thanos Query                               Prometheus            Sidecar     Thanos Query     Sidecar           Prometheus                                                         Prometheus                 Prometheus                                                                        Prometheus                     Prometheus               15                                                                                                                                                 Thanos                             Prometheus TSDB                Sidecar  Store Gateway                               Thanos Query                 Thanos Query                  Thanos      Store API                  Thanos Query        Thanos Store Gateway          Store API   Thanos Query           Thanos Store Gateway                          TSDB                                                                                                                 Ruler       Prometheus                                rules                                                                                      AlertManager              Prometheus            Prometheus                            Prometheus        Prometheus                        Prometheus        Thanos Ruler            Thanos Query             rules                  Store API        Thanos Query                                            Thanos Store Gateway     Thanos Query       Thanos Query   Thanos Ruler                 Thanos Ruler   Thanos Query               Thanos Query   Thanos Ruler                         Thanos                 Prometheus                                                Compact                                                                                                              Thanos Compact                                                                                                                                                    Thanos Bucket   Thanos Checker                                   Sidecar     Receiver                               Thanos Receiver                           https   thanos io proposals 201812_thanos remote receive md             Sidecar    Thanos                               Sidecar     Receiver              Receiver    Sidecar                                                       Sidecar              Prometheus    Query       Sidecar   Store API                    Sidecar         Sidecar   Query            Query      Sidecar                                               Thanos Receiver            Prometheus   remote write API       Prometheus           push   Thanos Receiver                Thanos Query        Sidecar            Thanos Receiver       Thanos Receiver                                  Thanos Store Gateway     Thanos Query                 Receiver                                   Receiver                                               Thanos                                          Thanos                                                 Thanos      TKE      k8s  TKEStack      k8s  EKS  Serverless k8s            Thanos",
        "objectID": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-arch",
        "weight": 20,
        "date": "2020-03-30T00:00:00.000Z"
    },
    {
        "title": "Thanos 部署与实践",
        "uri": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-deploy",
        "content": "Thanos              thanos                                  Thanos            Thanos               Kubernetes                             thanos   Kubernetes           prometheus operator         prometheus operator           CRD       Thanos            helm charts                 helm       thanos  kube thanos  Thanos              thanos   kubernetes   jsonnet     yaml             kube thanos     yaml     examples all manifests          prometheus operator      helm chart                                       kubernetes   yaml                            thanos                  thanos                               yaml                   Sidecar Receiver                           Sidecar    Receiver                      Sidecar                                                   Receiver      Prometheus    remote wirte API     push   Receiver                                         Query   Sidecar          Sidecar           Query     Sidecar                     Receiver         Receiver    Receiver   Query       Query     Receiver                           Prometheus     push            Receiver    IoT                 push                   Sidecar            Ruler Ruler                   Prometheus     rule                        Prometheus           Prometheus    rule              Thanos Ruler                     Thanos Ruler                                     Prometheus                       Prometheus        endpoint        record     rule                 Prometheus     rule                              alert     rule      Thanos Ruler                   Prometheus           alert                               Store Gateway   Compact Store             Thanos                         Store                                                Thanos                Thanos           Google Cloud Storage AWS S3 Azure Storage Account OpenStack Swift Tencent COS AliYun OSS                COS       OSS                                                                                                   minio       AWS   S3                      Thanos                                 Query       Thanos     Sidecar Receiver Ruler Store Gateway Compact                   objstore config           objstore config file                                  https   thanos io storage md                       Store Gateway       Compact                                            Compact                                                                                                                                                                         Thanos           Sidecar            k8s yaml                                                                                               thanos objectstorage secret yaml          COS      apiVersion  v1 kind  Secret metadata  name  thanos objectstorage namespace  thanos type  Opaque stringData  objectstorage yaml    type  COS config  bucket   thanos  region   ap singapore  app_id   12 5  secret_key   tsY Edm  secret_id   AKI  gEY          OSS     apiVersion  v1 kind  Secret metadata  name  thanos objectstorage namespace  thanos type  Opaque stringData  objectstorage yaml    type  ALIYUNOSS config  endpoint   oss cn hangzhou internal aliyuncs com  bucket   thanos  accesskeyid   LTA  KBu  accesskeysecret   oki  2HQ                  Prometheus    Sidecar      Sidecar         Prometheus    Thanos Sidecar    prometheus yaml  kind  Service apiVersion  v1 metadata  name  prometheus headless namespace  thanos labels  app kubernetes io name  prometheus spec  type  ClusterIP clusterIP  None selector  app kubernetes io name  prometheus ports  name  web protocol  TCP port  9090 targetPort  web name  grpc port  10901 targetPort  grpc apiVersion  v1 kind  ServiceAccount metadata  name  prometheus namespace  thanos apiVersion  rbac authorization k8s io v1beta1 kind  ClusterRole metadata  name  prometheus namespace  thanos rules  apiGroups       resources  nodes nodes proxy nodes metrics services endpoints pods verbs    get    list    watch   apiGroups       resources    configmaps   verbs    get   nonResourceURLs     metrics   verbs    get   apiVersion  rbac authorization k8s io v1beta1 kind  ClusterRoleBinding metadata  name  prometheus subjects  kind  ServiceAccount name  prometheus namespace  thanos roleRef  kind  ClusterRole name  prometheus apiGroup  rbac authorization k8s io apiVersion  apps v1 kind  StatefulSet metadata  name  prometheus namespace  thanos labels  app kubernetes io name  thanos query spec  serviceName  prometheus headless podManagementPolicy  Parallel replicas  2 selector  matchLabels  app kubernetes io name  prometheus template  metadata  labels  app kubernetes io name  prometheus spec  serviceAccountName  prometheus securityContext  fsGroup  2000 runAsNonRoot  true runAsUser  1000 affinity  podAntiAffinity  requiredDuringSchedulingIgnoredDuringExecution  labelSelector  matchExpressions  key  app kubernetes io name operator  values  prometheus topologyKey  kubernetes io hostname containers  name  prometheus image  quay io prometheus prometheus v2 15 2 args    config file  etc prometheus config_out p",
        "objectID": "monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-deploy",
        "weight": 30,
        "date": "2020-04-09T00:00:00.000Z",
        "draft": false,
        "state": "Beta"
    },
    {
        "title": "使用 kube-promethues 快速上手集群监控",
        "uri": "monitoring/kube-prometheus-quickstart",
        "content": "kube prometheus    kube prometheus      k8s                                      prometheus operator    prometheus       k8s         k8s CRD       prometheus   alertmanager                         CRD             prometheus   alertmanager          prometheus adapter    prometheus            k8s   resource metrics API   custom metrics API kubectl top   HPA          node exporter    DaemonSet                         prometheus            prometheus     kube state metrics    k8s          prometheus   metrics       prometheus       Node Pod        grafana                      https   github com coreos kube prometheus                                     git clone https   github com coreos kube prometheus git cd kube prometheus Create namespace CRDs  wait availble creating remaining resources kubectl create  f manifests setup until kubectl servicemonitors   all namespaces   date  sleep 1  echo     done kubectl create  f manifests     grafana           grafana   service      NodePort   LoadBalancer      Ingress     grafana               kubectl              kubectl port forward            kubectl port forward service grafana 3000 3000  n monitoring      http   localhost 3000      grafana               admin                         kube prometheus                grafana   dashboard           grafana",
        "objectID": "monitoring/kube-prometheus-quickstart",
        "weight": 10,
        "state": "Alpha"
    },
    {
        "title": "优化指南",
        "uri": "optimization",
        "content": "kuernetes            https   www processon com view link 5e4662ade4b0d86ec4018e50        children depth 3",
        "objectID": "optimization",
        "weight": 40
    },
    {
        "title": "应用部署优化",
        "uri": "optimization/deploy",
        "content": "replicas                                                children",
        "objectID": "optimization/deploy",
        "weight": 1
    },
    {
        "title": "使用 preStopHook 和 readinessProbe 保证服务平滑更新不中断",
        "uri": "optimization/deploy/smooth-update-using-prestophook-and-readinessprobe",
        "content": "Pod                      Pod                             tag         HPA  HorizontalPodAutoscaler              VPA  VerticalPodAutoscaler                                Service     Pod         Service     Endpoint            Pod IP Port    kube proxy     Service   Endpoint    Pod IP Port                  kube proxy                          K8S                        Controller    listAndWatch                    Pod        Endpoint                                                                  Pod                  Pod                    Pod        Endpoint Controller     Service    Endpoint   Pod IP Port       kube proxy watch               Service       iptables ipvs                              Pod    Pod                      Pod         Endpoint Controller watch        Service    Endpoint    kube proxy                       Pod                                                  Pod                               Pod    container   readinessProbe                       HTTP    kubelet                                 Ready   Pod        Ready     Pod     Endpoint Controller    Service    Endpoint IP Port       kube proxy                              Pod                                   Pod    container   preStop hook   Pod        sleep              Endpoint controller   kube proxy    Endpoint            Pod    Terminating                           Terminating   Pod                 sleep               yaml     apiVersion  extensions v1beta1 kind  Deployment metadata  name  nginx spec  replicas  1 selector  matchLabels  component  nginx template  metadata  labels  component  nginx spec  containers  name  nginx image   nginx  ports  name  http hostPort  80 containerPort  80 protocol  TCP readinessProbe  httpGet  path   healthz port  80 httpHeaders  name  X Custom Header value  Awesome initialDelaySeconds  15 timeoutSeconds  1 lifecycle  preStop  exec  command     bin bash     c    sleep 30        Container probes  https   kubernetes io docs concepts workloads pods pod lifecycle  container probes Container Lifecycle Hooks  https   kubernetes io docs concepts containers container lifecycle hooks",
        "objectID": "optimization/deploy/smooth-update-using-prestophook-and-readinessprobe"
    },
    {
        "title": "使用反亲和性避免单点故障",
        "uri": "optimization/deploy/use-antiaffinity-to-avoid-single-points-of-failure",
        "content": "k8s                                                                     replicas         1                1                                                                                         affinity  podAntiAffinity  requiredDuringSchedulingIgnoredDuringExecution  weight  100 labelSelector  matchExpressions  key  k8s app operator  values  kube dns topologyKey  kubernetes io hostname requiredDuringSchedulingIgnoredDuringExecution                                     Pending                 preferredDuringSchedulingIgnoredDuringExecution                                       labelSelector matchExpressions        pod   labels   key   value  topologyKey     kubernetes io hostname      pod                                            failure domain beta kubernetes io zone                                                         topologyKey        failure domain beta kubernetes io region",
        "objectID": "optimization/deploy/use-antiaffinity-to-avoid-single-points-of-failure"
    },
    {
        "title": "使用 PodDisruptionBudget 避免驱逐导致服务不可用",
        "uri": "optimization/deploy/use-pdb-to-avoid-service-unavailable-during-eviction",
        "content": "Pod               Pod     ReplicaSet        Pod            Pod                                                                                                                                                                                                                                PDB  PodDisruptionBudget                                  zookeeper             apiVersion  policy v1beta1 kind  PodDisruptionBudget metadata  name  zk pdb spec  minAvailable  2 selector  matchLabels  app  zookeeper            zookeeper                              apiVersion  policy v1beta1 kind  PodDisruptionBudget metadata  name  zk pdb spec  maxUnavailable  1 selector  matchLabels  app  zookeeper            https   kubernetes io docs tasks run application configure pdb",
        "objectID": "optimization/deploy/use-pdb-to-avoid-service-unavailable-during-eviction"
    },
    {
        "title": "ETCD 优化",
        "uri": "optimization/etcd",
        "content": "ETCD            https   github com etcd io etcd blob master Documentation op guide clustering md       self host             etcd operator    etcd                    etcd     etcd operator       IO    ETCD                             SSD           diskbench   fio          IOPS     ETCD     IO        ETCD                                                 ETCD         leader               ETCD                   sudo ionice  c2  n0  p   pgrep etcd            ETCD         2G    2G             ETCD      quota backend bytes               8G     events                                  event    event     etcd             etcd                        events        ETCD         kube apiserver    etcd servers  http   etcd1 2379 http   etcd2 2379 http   etcd3 2379    etcd servers overrides   events http   etcd4 2379 http   etcd5 2379 http   etcd6 2379                      ETCD leader                   follower        follower                dropped MsgProp 247ae21ff9436b2d streamMsg s sending buffer full dropped MsgAppResp 247ae21ff9436b2d streamMsg s sending buffer full            ETCD                    Linux        tc                 tc qdisc add dev eth0 root handle 1  prio bands 3   tc filter add dev eth0 parent 1  protocol ip prio 1 u32 match ip sport 2380 0xffff flowid 1 1   tc filter add dev eth0 parent 1  protocol ip prio 1 u32 match ip dport 2380 0xffff flowid 1 1   tc filter add dev eth0 parent 1  protocol ip prio 2 u32 match ip sport 2379 0xffff flowid 1 1   tc filter add dev eth0 parent 1  protocol ip prio 2 u32 match ip dport 2379 0xffff flowid 1 1",
        "objectID": "optimization/etcd"
    },
    {
        "title": "内核参数优化",
        "uri": "optimization/kernel",
        "content": "netfilter                     net netfilter nfconntrackmax 10485760 net netfilter nfconntracktcptimeoutestablished 300           64    8G     65536 16G         net netfilter nfconntrackbuckets 655360                                             net core netdevmaxbacklog 10000   socket   listen  backlog        socket      accept queue     tcp                                  128               32768    https   imroc io posts kubernetes overflow and drop  net core somaxconn 32768     syncookies     syn queue            somaxconn                1024    8096             net ipv4 tcpmaxsyn_backlog 8096                 inotify               watch  fs inotify maxuserinstances 8192 max file                                          open files    Socket File  Can t open so files     fs file max 2097152              watch   watch                                8192                      inotify watch           Pod       kubelet              524288 fs inotify maxuserwatches 524288 net core bpfjitenable 1 net core bpfjitharden 1 net core bpfjitkallsyms 1 net core devweighttx_bias 1 net core rmem_max 16777216 net core wmem_max 16777216 net ipv4 tcp_rmem 4096 12582912 16777216 net ipv4 tcp_wmem 4096 12582912 16777216 net core rpssockflow_entries 8192         arp     gc                    arp                         arp              https   k8s imroc io avoid cases arp cache overflow causes healthcheck failed     ARP                                    128 net ipv4 neigh default gc_thresh1 2048     ARP                                        5        512 net ipv4 neigh default gc_thresh2 4096     ARP                                              1024 net ipv4 neigh default gc_thresh3 8192 net ipv4 tcpmaxorphans 32768 net ipv4 tcpmaxtw_buckets 32768 vm maxmapcount 262144 kernel threads max 30058 net ipv4 ip_forward 1           coredump kernel core_pattern core",
        "objectID": "optimization/kernel"
    },
    {
        "title": "Master 优化",
        "uri": "optimization/master",
        "content": "Kubernetes   v1 6                 5000                      0   5000                               5000         150000   pod     300000             100   pod Master        GCE       1 5     n1 standard 1 6 10     n1 standard 2 11 100     n1 standard 4 101 250     n1 standard 8 251 500     n1 standard 16    500     n1 standard 32 AWS       1 5     m3 medium 6 10     m3 large 11 100     m3 xlarge 101 250     m3 2xlarge 251 500     c4 4xlarge    500     c4 8xlarge    CPU       1 5     1vCPU 3 75G   6 10     2vCPU 7 5G   11 100     4vCPU 15G   101 250     8vCPU 30G   251 500     16vCPU 60G      500     32vCPU 120G   kube apiserver                  kube apiserver        LB                  apiserver count     endpoint reconciler type       kube apiserver       Kubernetes Service   endpoints                 TLS                                                                                              kube apiserver                  max mutating requests inflight int maximum number mutating requests flight given time  When server exceeds this  rejects requests  Zero no limit   default 200    max requests inflight int maximum number non mutating requests flight given time  When server exceeds this  rejects requests  Zero no limit   default 400        1000   3000           max requests inflight 1500   max mutating requests inflight 500        3000         max requests inflight 3000   max mutating requests inflight 1000 kube scheduler   kube controller manager        kube controller manager   kube scheduler     leader election                      leader elect true   leader elect lease duration 15s   leader elect renew deadline 10s   leader elect resource lock endpoints   leader elect retry period 2s    QPS   kube apiserver     qps           kube api qps 100    DNS               DNS  kube dns   coredns                  affinity  podAntiAffinity  requiredDuringSchedulingIgnoredDuringExecution  weight  100 labelSelector  matchExpressions  key  k8s app operator  values  kube dns topologyKey  kubernetes io hostname",
        "objectID": "optimization/master"
    },
    {
        "title": "安全指南",
        "uri": "security",
        "content": "children depth 3",
        "objectID": "security",
        "weight": 40
    },
    {
        "title": "集群证书管理",
        "uri": "security/cert",
        "content": "",
        "objectID": "security/cert"
    },
    {
        "title": "使用 cert-manager 自动生成证书",
        "uri": "security/cert/autogenerate-certificate-with-cert-manager",
        "content": "cert manager           cert manager    Let s Encrypt                 Let s Encrypt    ACME                                         90                         cert manager                                                  HTTP 01   DNS 01              HTTP 01      HTTP 01               HTTP          location  Let s Encrypt     http     http     well known acme challenge  YOUR_DOMAIN          TOKEN   ACME                   ACME       cert manager       Ingress                    TOKEN     Let s Encrypt     TOKEN                               Ingress                         DNS 01      DNS 01          DNS      API Key      DNS         Let s Encrypt   ACME          ACME       cert manager                     TXT            _acme challenge      Let s Encrypt    DNS                                      Ingress               Issuer ClusterIssuer                  Issuer   ClusterIssuer          Issuer            namespace      ClusterIssuer        namespace                                             ClusterIssuer          DNS 01     ClusterIssuer        cloudflare         cloudflare    API Key        Secret  kubectl  n cert manager create secret generic cloudflare apikey   from literal apikey 213807bdxxxxxxxxxxxxxx58eac90492e6287      ClusterIssuer   NonNamespaced                      Secret   Secret                   ClusterIssuer     Secret    cert manager               DNS 01       ClusterIssuer  cat",
        "objectID": "security/cert/autogenerate-certificate-with-cert-manager",
        "weight": 20
    },
    {
        "title": "安装 cert-manager",
        "uri": "security/cert/install-cert-manger",
        "content": "https   docs cert manager io en latest getting started install kubernetes html                                      cert manger                                          kubectl create namespace cert manager      yaml           kubectl apply      kubectl apply   validate false  f https   github com jetstack cert manager releases download v0 13 1 cert manager yaml      kubectl v1 15 4               validate false                    cert manager     pod           kubectl pods   namespace cert manager NAME READY STATUS RESTARTS AGE cert manager 5c6866597 zw7kh 1 1 Running 0 2m cert manager cainjector 577f6d9fd7 tr77l 1 1 Running 0 2m cert manager webhook 787858fcdb nlzsq 1 1 Running 0 2m",
        "objectID": "security/cert/install-cert-manger",
        "weight": 10
    },
    {
        "title": "集群权限控制",
        "uri": "security/permission",
        "content": "K8S                       User                   ServiceAccount",
        "objectID": "security/permission"
    },
    {
        "title": "控制应用权限",
        "uri": "security/permission/app",
        "content": "Pod    Serivce Account                        default    Service Account               Pod     apiserver    service account admission controller    Pod       ServiceAccount              default              ServiceAccount                Pod        ServiceAccount     Secret     Pod         var run secrets kubernetes io serviceaccount         Secret   controller manager   token controller   watch ServiceAccount     ServiceAccount       token     Secret      Pod           apiserver            SDK     client go   SDK    in cluster       apiserver        var run secrets kubernetes io serviceaccount            apiserver            RBAC                RBAC        ServiceAccount              Pod     ServiceAccount             ServiceAccount        default                        RBAC       build robot    ServiceAccount      build       Pod      log  apiVersion  v1 kind  ServiceAccount metadata  name  build robot namespace  build apiVersion  rbac authorization k8s io v1 kind  Role metadata  namespace  build name  pod reader rules  apiGroups       resources    pods    pods log   verbs    get    list   apiVersion  rbac authorization k8s io v1 kind  RoleBinding metadata  name  read pods namespace  build subjects  kind  ServiceAccount name  build robot apiGroup  rbac authorization k8s io roleRef  kind  Role name  pod reader apiGroup  rbac authorization k8s io   Pod    ServiceAccount     apiVersion  v1 kind  Pod metadata  name  build namespace  build spec  containers  image  imroc build robot v1 name  builder serviceAccountName  build robot         imagePullSecrets ServiceAccount        imagePullSecrets        Pod       ServiceAccount       imagePullSecrets        ServiceAccount        default         default     ServiceAccount    imagePullSecrets                 imagePullSecrets    imagePullSecrets  kubectl create secret docker registry   docker server    docker username    docker password    docker email   n           imagePullSecrets               imagePullSecrets                               Docker            Docker           Docker         imagePullSecrets  kubectl patch serviceaccount default  p    imagePullSecrets      name           n       ServiceAccount      imagePullSecrets           ServiceAccount           imagePullSecrets               Configure Service Accounts Pods  https   kubernetes io docs tasks configure pod container configure service account",
        "objectID": "security/permission/app"
    },
    {
        "title": "控制用户权限",
        "uri": "security/permission/user",
        "content": "admin                                                                                 apiserver                                                       RBAC         kube apiserver        authorization mode RBAC           User   ServiceAccount    Role   ClusterRole        User    User         token       kube apiserver        token auth file     token            token auth file  etc kubernetes known_tokens csv token                 wJmq  PPWj admin admin system masters        token               token                        CA                  CN        O         RBAC               RBAC         roc    test          istio system            kind  Role apiVersion  rbac authorization k8s io v1 metadata  name  admin namespace  test rules  apiGroups        resources        verbs        kind  RoleBinding apiVersion  rbac authorization k8s io v1 metadata  name  admin to roc namespace  test subjects  kind  User name  roc apiGroup  rbac authorization k8s io roleRef  kind  Role name  admin apiGroup  rbac authorization k8s io kind  Role apiVersion  rbac authorization k8s io v1 metadata  name  readonly namespace  istio system rules  apiGroups        resources        verbs    get    watch    list   kind  RoleBinding apiVersion  rbac authorization k8s io v1 metadata  name  readonly to roc namespace  istio system subjects  kind  User name  roc apiGroup  rbac authorization k8s io roleRef  kind  Role name  readonly apiGroup  rbac authorization k8s io   roc              kind  ClusterRole apiVersion  rbac authorization k8s io v1 metadata  name  readonly rules  apiGroups        resources        verbs    get    watch    list   kind  ClusterRoleBinding apiVersion  rbac authorization k8s io v1 metadata  name  readonly to roc subjects  kind  User name  roc apiGroup  rbac authorization k8s io roleRef  kind  ClusterRole name  readonly apiGroup  rbac authorization k8s io   manager            secret      apiVersion  rbac authorization k8s io v1 kind  ClusterRole metadata  name  secret reader rules  apiGroups       resources    secrets   verbs    get    watch    list   apiVersion  rbac authorization k8s io v1 kind  ClusterRoleBinding metadata  name  read secrets global subjects  kind  Group name  manager apiGroup  rbac authorization k8s io roleRef  kind  ClusterRole name  secret reader apiGroup  rbac authorization k8s io    kubeconfig                         kubectl config set credentials   embed certs true   client certificate    client key       token                   kubectl config set credentials   token      cluster entry kubectl config set cluster   server    certificate authority    context entry kubectl config set context   cluster    user         context kubectl config use context    kubectl config view      https   kubernetes io zh docs reference access authn authz service accounts admin  https   kubernetes io docs reference access authn authz rbac",
        "objectID": "security/permission/user"
    },
    {
        "title": "用户管理",
        "uri": "security/user",
        "content": "children depth 3",
        "objectID": "security/user"
    },
    {
        "title": "利用 CSR API 创建用户",
        "uri": "security/user/create-user-using-csr-api",
        "content": "k8s    CSR API      CertificateSigningRequest         CSR              kube controller manager              kube controller manager             cluster signing cert file  var lib kubernetes ca pem   cluster signing key file  var lib kubernetes ca key pem          cfssl     key   csr            cfssl  curl  L https   pkg cfssl org R1 2 cfssl_linux amd64  o cfssl curl  L https   pkg cfssl org R1 2 cfssljson_linux amd64  o cfssljson curl  L https   pkg cfssl org R1 2 cfssl certinfo_linux amd64  o cfssl certinfo chmod  x cfssl cfssljson cfssl certinfo sudo mv cfssl cfssljson cfssl certinfo  usr local bin             USERNAME  roc      key   csr     cat   USERNAME  pem         roc pem                           roc pem roc key pem    kubeconfig    user kubectl config set credentials   USERNAME    embed certs true   client certificate   USERNAME  pem   client key   USERNAME  key pem       cluster             kubectl config set cluster   server    certificate authority     context    cluster   user kubectl config set context   cluster    user   USERNAME         context kubectl config use context              RBAC              RBAC             Manage TLS Certificates Cluster  https   kubernetes io docs tasks tls managing tls in a cluster",
        "objectID": "security/user/create-user-using-csr-api"
    },
    {
        "title": "奇技淫巧",
        "uri": "trick",
        "content": "children",
        "objectID": "trick",
        "weight": 41
    },
    {
        "title": "kubectl 高效技巧",
        "uri": "trick/efficient-kubectl",
        "content": "k             kubectl                                                                                                           shell    k       session    function k     cmdline HISTTIMEFORMAT    history   awk   2     kubectl        n        namespace    for i 2 i",
        "objectID": "trick/efficient-kubectl"
    },
    {
        "title": "在容器内使用 perf",
        "uri": "trick/perf-in-container",
        "content": "perf       perfeventopen                               kernel perfeventparanoid    1      perfeventopen         dockerd    seccomp profile        perfeventopen CAPSYSADMIN            seccomp unconfined   k8s      kubelet    pod  seccomp unconfined SecurityOpt",
        "objectID": "trick/perf-in-container",
        "state": "TODO"
    },
    {
        "title": "实用命令与脚本",
        "uri": "trick/shell",
        "content": "children",
        "objectID": "trick/shell"
    },
    {
        "title": "网络调试相关脚本",
        "uri": "trick/shell/network",
        "content": "netns           function e     set  eu ns   2  default   pod kubectl  n  ns describe pod  1   grep  A10   Containers     grep  Eo  docker         head  n 1   sed  s docker             1   pid docker inspect  f    State Pid    pod echo  entering pod netns  ns  1  cmd  nsenter  n   target  pid  echo  cmd  cmd                 pod   netns     kube system         metrics server 6cf9685556 rclw5   pod     netns e metrics server 6cf9685556 rclw5 kube system    pod   netns              netns          ip      ip   ip route        tcpdump                TCP          true  echo      telnet 10 0 0 3 443  sleep 0 1  done ctrl c         10 0 0 3   443        IP",
        "objectID": "trick/shell/network"
    },
    {
        "title": "节点相关脚本",
        "uri": "trick/shell/node",
        "content": "podCIDR kubectl no  o custom columns INTERNAL IP  metadata name EXTERNAL IP  status addresses 1  address CIDR  spec podCIDR       INTERNAL IP EXTERNAL IP CIDR 10 100 12 194 152 136 146 157 10 101 64 64 27 10 100 16 11 10 100 16 11 10 101 66 224 27 10 100 16 24 10 100 16 24 10 101 64 32 27 10 100 16 26 10 100 16 26 10 101 65 0 27 10 100 16 37 10 100 16 37 10 101 64 0 27               Allocatable  kubectl no  o custom columns  NODE  metadata name ALLOCATABLE CPU  status allocatable cpu ALLOCATABLE MEMORY  status allocatable memory        NODE ALLOCATABLE CPU ALLOCATABLE MEMORY 10 0 0 2 3920m 7051692Ki 10 0 0 3 3920m 7051816Ki                               kubectl nodes   no headers   awk   print  1     xargs  I    sh  c  echo      kubectl describe node      grep Allocated  A 5   grep  ve Event  ve Allocated  ve percent  ve            10 0 0 2 Resource Requests Limits cpu 3040m  77   19800m  505   memory 4843402752  67   15054901888  208   10 0 0 3 Resource Requests Limits cpu 300m  7   1  25   memory 250M  3   2G  27        cpu        kubectl nodes   no headers   awk   print  1     xargs  I    sh  c  echo  n     t    kubectl describe node      grep Allocated  A 5   grep  ve Event  ve Allocated  ve percent  ve      grep cpu   awk      print  2 3              10 0 0 2 3040m 77   10 0 0 3 300m 7        memory        kubectl nodes   no headers   awk   print  1     xargs  I    sh  c  echo  n     t    kubectl describe node      grep Allocated  A 5   grep  ve Event  ve Allocated  ve percent  ve      grep memory   awk      print  2 3              10 0 0 2 4843402752 67   10 0 0 3 250M 3           printf   NUM PID t tCOMMAND n     ps  eLf   awk    1 null  3 null  4 null  5 null  6 null  7 null  8 null  9 null print     sort  uniq  c  sort  rn   head  10       NUM PID COMMAND 594 14418 java  server  Dspring profiles active production  Xms2048M  Xmx2048M  Xss256k  Dinfo app version 33  XX  UseG1GC  XX  UseStringDeduplication  XX  PrintGCDateStamps  verbosegc  Dcom sun management jmxremote  Dcom sun management jmxremote authenticate false  Dcom sun management jmxremote ssl false  Dcom sun management jmxremote port 10011  Xloggc  home log gather server gather server gac log  Ddefault client encoding UTF 8  Dfile encoding UTF 8  Dlogging path  home log gather server  Dserver tomcat accesslog directory  home log gather server  jar  home app gather server jar   server port 8080   management port 10086 449 7088 java  server  Dspring profiles active production  Dspring cloud config token nLfe bQ0CcGnNZQ4Pt9KTizgRghZrGUVVqaDZYHU3R Y U6k7jkm8RrBn7LPJD  Xms4256M  Xmx4256M  Xss256k  XX  PrintFlagsFinal  XX  UseG1GC  XX  UseStringDeduplication  XX MaxGCPauseMillis 200  XX MetaspaceSize 128M  Dcom sun management jmxremote  Dcom sun management jmxremote authenticate false  Dcom sun management jmxremote ssl false  Dcom sun management jmxremote port 10011  verbosegc  XX  PrintGCDateStamps  XX  UseGCLogFileRotation  XX NumberOfGCLogFiles 15  XX GCLogFileSize 50M  XX AutoBoxCacheMax 520  Xloggc  home log oauth server oauth server gac log  Dinfo app version 12  Ddefault client encoding UTF 8  Dfile encoding UTF 8  Dlogging config classpath log4j2 spring prod xml  Dlogging path  home log oauth server  Dserver tomcat accesslog directory  home log oauth server  jar  home app oauth server jar   server port 8080   management port 10086   zuul server netty threads worker 14   zuul server netty socket epoll true 394 516 java  server  Dspring profiles active production  Xms2048M  Xmx2048M  Xss1024k  Dinfo app version 43  XX  UseG1GC  XX  UseStringDeduplication  XX  PrintGCDateStamps  verbosegc  Dcom sun management jmxremote  Dcom sun management jmxremote authenticate false  Dcom sun management jmxremote ssl false  Dcom sun management jmxremote port 10011  Xloggc  home log asset server asset server gac log  Ddefault client encoding UTF 8  Dfile encoding UTF 8  Dlogging path  home log asset server  Dserver tomcat accesslog directory  home log asset server  jar  home app asset server jar   server port 8080   management port 10086 305 14668 java  server  Dspring profiles active production  Xms1024M  Xmx1024M  Xss256k  Dinfo app version 3  XX  UseG1GC  XX  UseStringDeduplication  XX  PrintGCDateStamps  verbosegc  Dcom sun management jmxremote  Dcom sun management jmxremote authenticate false  Dcom sun management jmxremote ssl false  Dcom sun management jmxremote port 10011  Xloggc  home log talent adapter distribute talent adapter distribute gac log  Ddefault client encoding UTF 8  Dfile encoding UTF 8  Dlogging path  home log talent adapter distribute  Dserver tomcat accesslog directory  home log talent adapter distribute  jar  home app talent adapter distribute jar   server port 8080   management port 10086 250 3979 java  server  Dspring profiles active production  Xms2048M  Xmx2048M  Xss256k  Dinfo app version 20  XX  UseG1GC  XX  UseStringDeduplication  XX  PrintGCDateStamps  verbosegc  Dcom sun management jmxremote  Dcom sun management jmxremote authenticate false  Dcom sun management jmxremote ssl false  Dcom sun management jmxremote port 10011  Xloggc  home log ",
        "objectID": "trick/shell/node"
    },
    {
        "title": "Pod 相关脚本",
        "uri": "trick/shell/pod",
        "content": "Evicted   pod kubectl pod  o wide   all namespaces   awk   if  4   Evicted   cmd  kubectl  n   1  delete pod   2  system cmd         Running   pod kubectl pod  o wide   all namespaces   awk   if  4   Running   cmd  kubectl  n   1  delete pod   2  system cmd          NAMESPACE  kube system  WORKLOAD_TYPE  daemonset  WORKLOAD_NAME  ip masq agent  CONTAINER_NAME  ip masq agent  IMAGE  ccr ccs tencentyun com library ip masq agent v2 5 0  kubectl  n  NAMESPACE patch  WORKLOADTYPE  WORKLOADNAME   patch    spec     template     spec     containers      name     CONTAINER_NAME   image     IMAGE",
        "objectID": "trick/shell/pod"
    },
    {
        "title": "泛域名动态转发 Service",
        "uri": "trick/wildcard-domain-forward",
        "content": "IP            Ingress   Service   DNS              IP      test imroc io             Host          Service    a test imroc io         my svc a b test imroc io        my svc b    K8S   Ingress                                                                     Ingress               Host         Service Ingress        apiVersion  extensions v1beta1 kind  Ingress metadata  name  my ingress spec  rules  host  a test imroc io http  paths  backend  serviceName  my svc a servicePort  80 path    host  b test imroc io http  paths  backend  serviceName  my svc b servicePort  80 path          Host           200        Host     Ingress           Ingress                 LB                                     Host                 Service                 Service              a test imroc io     my svc a    Service                                                       Host                         Service                DNS                  Nginx Lua                             OpenResty            Nginx         lua                    nginx   proxypass            proxypass              lua     Host      nginx   proxy_pass               IP    dns                        dns        nginx conf     resolver             dns               go dnsmasq             dns       nginx   sidecar        pod      53    nginx conf                      yaml    proxy yaml  apiVersion  apps v1beta1 kind  Deployment metadata  labels  component  nginx name  proxy spec  replicas  1 selector  matchLabels  component  nginx template  metadata  labels  component  nginx spec  containers  name  nginx image   openresty openresty centos  ports  name  http containerPort  80 protocol  TCP volumeMounts  mountPath   usr local openresty nginx conf nginx conf name  config subPath  nginx conf name  dnsmasq image   janeczku go dnsmasq release 1 0 7  args    listen  127 0 0 1 53    default resolver   append search domains   hostsfile  etc hosts   verbose volumes  name  config configMap  name  configmap nginx apiVersion  v1 kind  ConfigMap metadata  labels  component  nginx name  configmap nginx data  nginx conf     worker_processes 1  error_log  error log  events   accept_mutex on  multi_accept on  use epoll  worker_connections 1024    http   include mime types  default_type application octet stream  logformat main   timelocal  remoteuser  remoteaddr  host  requesturi  requestmethod  http_cookie     status  bodybytessent   http_referer       httpuseragent    httpxforwarded_for      requesttime  upstreamresponsetime   upstreamcache_status    logformat browser   timeiso8601  cookiekmuid  remoteaddr  host  requesturi  request_method     status  bodybytessent   http_referer       httpuseragent    httpxforwarded_for      requesttime  upstreamresponsetime   upstreamcachestatus   httpxrequestedwith  httpxrealip  upstreamaddr  request_body   logformat client     timestamp    timeiso8601      timelocal    timelocal      remoteuser    remoteuser      httpxforwardedfor    httpxforwardedfor      host    server_addr      remoteaddr    remoteaddr      httpxrealip    httpxrealip      bodybytessent   bodybytessent     requesttime   requesttime     status   status     upstreamresponsetime    upstreamresponsetime      upstreamresponsestatus    upstream_status      request    request      httpreferer    httpreferer      httpuseragent    httpuseragent     access_log  access log main  sendfile on  keepalive_timeout 120s 100s  keepalive_requests 500  send_timeout 60000s  clientheaderbuffer_size 4k  proxyignoreclient_abort on  proxy_buffers 16 32k  proxybuffersize 64k  proxybusybuffers_size 64k  proxysendtimeout 60000  proxyreadtimeout 60000  proxyconnecttimeout 60000  proxycachevalid 200 304 2h  proxycachevalid 500 404 2s  proxycachekey  host requesturi cookieuser  proxycachemethods HEAD POST  proxy_redirect off  proxyhttpversion 1 1  proxysetheader Host  http_host  proxysetheader X Real IP  remote_addr  proxysetheader X Forwarded For  proxyaddxforwardedfor  proxysetheader X Forwarded Proto  scheme  proxysetheader X Frame Options SAMEORIGIN  server_tokens off  clientmaxbody_size 50G  addheader X Cache  upstreamcache_status  autoindex off  resolver 127 0 0 1 53 ipv6 off  server   listen 80  location     set  service     rewritebylua   local host   ngx var host local m   ngx re match host        test imroc io   m ngx var service    my svc      m 1  end    proxy_pass http    service                        Service   Ingress   Service       service yaml    apiVersion  v1 kind  Service metadata  labels  component  nginx name  service nginx spec  type  LoadBalancer ports  name  http port  80 targetPort  http selector  component  nginx   Ingress       ingress yaml    apiVersion  extensions v1beta1 kind  Ingress metadata  name  ingress nginx spec  rules  host     test imroc io  http  paths  backend  serviceName  service nginx servicePort  80 path",
        "objectID": "trick/wildcard-domain-forward"
    },
    {
        "title": "yaml 片段",
        "uri": "trick/yaml",
        "content": "",
        "objectID": "trick/yaml"
    },
    {
        "title": "Deployment",
        "uri": "trick/yaml/deployment",
        "content": "nginx      apiVersion  apps v1 kind  Deployment metadata  name  nginx spec  replicas  1 selector  matchLabels  app  nginx template  metadata  labels  app  nginx spec  containers  name  nginx image  nginx apiVersion  v1 kind  Service metadata  name  nginx labels  app  nginx spec  type  ClusterIP ports  port  80 protocol  TCP name  http selector  app  nginx",
        "objectID": "trick/yaml/deployment"
    },
    {
        "title": "排错指南",
        "uri": "troubleshooting",
        "content": "kuernetes            https   www processon com view link 5e4662ade4b0d86ec4018e50        children depth 3",
        "objectID": "troubleshooting",
        "weight": 20
    },
    {
        "title": "处理实践",
        "uri": "troubleshooting/handle",
        "content": "children",
        "objectID": "troubleshooting/handle",
        "weight": 20
    },
    {
        "title": "arp_cache 溢出",
        "uri": "troubleshooting/handle/arp_cache-overflow",
        "content": "arp_cache                   arp_cache  neighbor table overflow       arp        arp  an   wc  l 1335    arp gc       sysctl  a   grep gc_thresh net ipv4 neigh default gc_thresh1   128 net ipv4 neigh default gc_thresh2   512 net ipv4 neigh default gc_thresh3   1024 net ipv6 neigh default gc_thresh1   128 net ipv6 neigh default gc_thresh2   512 net ipv6 neigh default gc_thresh3   1024    arp       gcthresh3      overflow     arp      gcthresh3        gc                       IP   arp cache      mac            arp cache      1      gcthresh3                 arpcache  neighbor table overflow                  arp cache   gc        etc sysctl conf   net ipv4 neigh default gc_thresh1   80000 net ipv4 neigh default gc_thresh2   90000 net ipv4 neigh default gc_thresh3   100000             Pod                arp                                     Node          kubectl label node host1 arp_cache large     nodeSelector   nodeAffnity            arp_cache     Pod                nodeAffnity yaml     template  spec  affinity  nodeAffinity  requiredDuringSchedulingIgnoredDuringExecution  nodeSelectorTerms  matchExpressions  key  arp_cache operator  values  large",
        "objectID": "troubleshooting/handle/arp_cache-overflow"
    },
    {
        "title": "磁盘爆满",
        "uri": "troubleshooting/handle/disk-full",
        "content": "kubelet   gc            image gc high threshold    image gc low threshold    eviction hard    eviction soft    eviction minimum reclaim       kubelet   gc                                                              K8S                                             K8S          kubelet                               kubelet                                                              kubelet                        df                                                                     docker    docker         hang    kubelet         PLEG unhealthy    CRI    timeout                     Pod    ContainerCreating      Terminating  docker              var run docker                dockerd     exec root        var lib docker                                          docker     volume   Pod               Warning FailedCreatePodSandBox 53m kubelet  172 22 0 44 Failed create pod sandbox  rpc error  code   DeadlineExceeded desc   context deadline exceeded Warning FailedCreatePodSandBox 2m  x4307 16h  kubelet  10 179 80 31  combined similar events   Failed create pod sandbox  rpc error  code   Unknown desc   failed create sandbox pod  apigateway 6dc48bf8b6 l8xrw   Error response daemon  mkdir  var lib docker aufs mnt 1f09d6c1c9f24e8daaea5bf33a4230de7dbc758e3b22785e8ee21e3e3d921214 init  no space left device Warning Failed 5m1s  x3397 17h  kubelet  ip 10 0 151 35 us west 2 compute internal  combined similar events   Error  container create failed  containerlinux go 336  starting container process caused  processlinux go 399  container init caused   rootfs_linux go 58  mounting      sys     rootfs      var lib dockerd storage overlay 051e985771cc69f3f699895a1dada9ef6483e912b46a99e004af7bb4852183eb merged          var lib dockerd storage overlay 051e985771cc69f3f699895a1dada9ef6483e912b46a99e004af7bb4852183eb merged sys     caused     no space left device        Pod               Normal Killing 39s  x735 15h  kubelet  10 179 80 31 Killing container id docker   apigateway Need kill Pod kubelet                kubelet                          Pod    Sandbox            mkdir                Pod     Warning UnexpectedAdmissionError 44m kubelet  172 22 0 44 Update plugin resources failed due failed write checkpoint file  kubeletinternalcheckpoint   write  var lib kubelet device plugins  728425055  no space left device  unexpected  kubelet           var lib kubelet           Pod            volume     emptyDir  ConfigMap  Secret     kubelet     root dir                            Docker                Docker       TODO                    Docker          dockerd                 dockerd                                      dockerd                   docker   log               log    cd  var lib docker containers   du  sh                cd dda02c9a7491fa797ab730c1568ba06cba74cecd4e4a82e9d90d00fa11de743c   cat  dev null   dda02c9a7491fa797ab730c1568ba06cba74cecd4e4a82e9d90d00fa11de743c json log 9     log          cat  dev null           rm     rm       docker                     log                           node               pod              dockerd         pod                                       volume             kubectl drain    dockerd  systemctl restart dockerd systemctl restart docker       pod                                      kubectl uncordon             kubelet gc                           pod                     Pod    ContainerCreating   Terminating",
        "objectID": "troubleshooting/handle/disk-full"
    },
    {
        "title": "高负载",
        "uri": "troubleshooting/handle/high-load",
        "content": "TODO                      cpu                timeout                  IO          cpu  us    user       cpu  id    idle                             IO          IO WAIT                               top           top   19 42 06 23 59  2 users  load average  34 64  35 80  35 76 Tasks  679 total  1 running  678 sleeping  0 stopped  0 zombie Cpu s   15 6 us  1 7 sy  0 0 ni  74 7 id  7 9 wa  0 0 hi  0 1 si  0 0 st Mem  32865032k total  30989168k used  1875864k free  370748k buffers Swap  8388604k total  5440k used  8383164k free  7982424k cached PID USER PR NI VIRT RES SHR S  CPU  MEM TIME  COMMAND 9783 mysql 20 0 17 3g 16g 8104 S 186 9 52 3 3752 33 mysqld 5700 nginx 20 0 1330m 66m 9496 S 8 9 0 2 0 20 82 php fpm 6424 nginx 20 0 1330m 65m 8372 S 8 3 0 2 0 04 97 php fpm 6573 nginx 20 0 1330m 64m 7368 S 8 3 0 2 0 01 49 php fpm 5927 nginx 20 0 1320m 56m 9272 S 7 6 0 2 0 12 54 php fpm 5956 nginx 20 0 1330m 65m 8500 S 7 6 0 2 0 12 70 php fpm 6126 nginx 20 0 1321m 57m 8964 S 7 3 0 2 0 09 72 php fpm 6127 nginx 20 0 1319m 54m 9520 S 6 6 0 2 0 08 73 php fpm 6131 nginx 20 0 1320m 56m 9404 S 6 6 0 2 0 09 43 php fpm 6174 nginx 20 0 1321m 56m 8444 S 6 3 0 2 0 08 92 php fpm 5790 nginx 20 0 1319m 54m 9468 S 5 6 0 2 0 17 33 php fpm 6575 nginx 20 0 1320m 55m 8212 S 5 6 0 2 0 02 11 php fpm 6160 nginx 20 0 1310m 44m 8296 S 4 0 0 1 0 10 05 php fpm 5597 nginx 20 0 1310m 46m 9556 S 3 6 0 1 0 21 03 php fpm 5786 nginx 20 0 1310m 45m 8528 S 3 6 0 1 0 15 53 php fpm 5797 nginx 20 0 1310m 46m 9444 S 3 6 0 1 0 14 02 php fpm 6158 nginx 20 0 1310m 45m 8324 S 3 6 0 1 0 10 20 php fpm 5698 nginx 20 0 1310m 46m 9184 S 3 3 0 1 0 20 62 php fpm 5779 nginx 20 0 1309m 44m 8336 S 3 3 0 1 0 15 34 php fpm 6540 nginx 20 0 1306m 40m 7884 S 3 3 0 1 0 02 46 php fpm 5553 nginx 20 0 1300m 36m 9568 S 3 0 0 1 0 21 58 php fpm 5722 nginx 20 0 1310m 45m 8552 S 3 0 0 1 0 17 25 php fpm 5920 nginx 20 0 1302m 36m 8208 S 3 0 0 1 0 14 23 php fpm 6432 nginx 20 0 1310m 45m 8420 S 3 0 0 1 0 05 86 php fpm 5285 nginx 20 0 1302m 38m 9696 S 2 7 0 1 0 23 41 php fpm wa   wait      IO WAIT   cpu                         wa        1   top   19 42 08 23 59  2 users  load average  34 64  35 80  35 76 Tasks  679 total  1 running  678 sleeping  0 stopped  0 zombie Cpu0   29 5 us  3 7 sy  0 0 ni  48 7 id  17 9 wa  0 0 hi  0 1 si  0 0 st Cpu1   29 3 us  3 7 sy  0 0 ni  48 9 id  17 9 wa  0 0 hi  0 1 si  0 0 st Cpu2   26 1 us  3 1 sy  0 0 ni  64 4 id  6 0 wa  0 0 hi  0 3 si  0 0 st Cpu3   25 9 us  3 1 sy  0 0 ni  65 5 id  5 4 wa  0 0 hi  0 1 si  0 0 st Cpu4   24 9 us  3 0 sy  0 0 ni  66 8 id  5 0 wa  0 0 hi  0 3 si  0 0 st Cpu5   24 9 us  2 9 sy  0 0 ni  67 0 id  4 8 wa  0 0 hi  0 3 si  0 0 st Cpu6   24 2 us  2 7 sy  0 0 ni  68 3 id  4 5 wa  0 0 hi  0 3 si  0 0 st Cpu7   24 3 us  2 6 sy  0 0 ni  68 5 id  4 2 wa  0 0 hi  0 3 si  0 0 st Cpu8   23 8 us  2 6 sy  0 0 ni  69 2 id  4 1 wa  0 0 hi  0 3 si  0 0 st Cpu9   23 9 us  2 5 sy  0 0 ni  69 3 id  4 0 wa  0 0 hi  0 3 si  0 0 st Cpu10   23 3 us  2 4 sy  0 0 ni  68 7 id  5 6 wa  0 0 hi  0 0 si  0 0 st Cpu11   23 3 us  2 4 sy  0 0 ni  69 2 id  5 1 wa  0 0 hi  0 0 si  0 0 st Cpu12   21 8 us  2 4 sy  0 0 ni  60 2 id  15 5 wa  0 0 hi  0 0 si  0 0 st Cpu13   21 9 us  2 4 sy  0 0 ni  60 6 id  15 2 wa  0 0 hi  0 0 si  0 0 st Cpu14   21 4 us  2 3 sy  0 0 ni  72 6 id  3 7 wa  0 0 hi  0 0 si  0 0 st Cpu15   21 5 us  2 2 sy  0 0 ni  73 2 id  3 1 wa  0 0 hi  0 0 si  0 0 st Cpu16   21 2 us  2 2 sy  0 0 ni  73 6 id  3 0 wa  0 0 hi  0 0 si  0 0 st Cpu17   21 2 us  2 1 sy  0 0 ni  73 8 id  2 8 wa  0 0 hi  0 0 si  0 0 st Cpu18   20 9 us  2 1 sy  0 0 ni  74 1 id  2 9 wa  0 0 hi  0 0 si  0 0 st Cpu19   21 0 us  2 1 sy  0 0 ni  74 4 id  2 5 wa  0 0 hi  0 0 si  0 0 st Cpu20   20 7 us  2 0 sy  0 0 ni  73 8 id  3 4 wa  0 0 hi  0 0 si  0 0 st Cpu21   20 8 us  2 0 sy  0 0 ni  73 9 id  3 2 wa  0 0 hi  0 0 si  0 0 st Cpu22   20 8 us  2 0 sy  0 0 ni  74 4 id  2 8 wa  0 0 hi  0 0 si  0 0 st Cpu23   20 8 us  1 9 sy  0 0 ni  74 4 id  2 8 wa  0 0 hi  0 0 si  0 0 st Mem  32865032k total  30209248k used  2655784k free  370748k buffers Swap  8388604k total  5440k used  8383164k free  7986552k cached wa     0        1                       cpu           atop        IO     ATOP   lemp 2017 01 23 19 42 32           10s elapsed PRC   sys 3 18s   user 33 24s    proc 679    tslpu 28    zombie 0    exit 0   CPU   sys 29    user 330    irq 1    idle 1857    wait 182    curscal 69    CPL   avg1 33 00   avg5 35 29   avg15 35 59   csw 62610   intr 76926   numcpu 24   MEM   tot 31 3G   free 2 1G   cache 7 6G   dirty 41 0M   buff 362 1M   slab 1 2G   SWP   tot 8 0G   free 8 0G       vmcom 23 9G   vmlim 23 7G   DSK   sda   busy 100    read 4   write 1789   MBw s 2 84   avio 5 58 ms   NET   transport   tcpi 10357   tcpo 9065   udpi 0   udpo 0   tcpao 174   NET   network   ipi 10360   ipo 9065   ipfrw 0   deliv 10359   icmpo 0   NET   eth0 4    pcki 6649   pcko 6136   si 1478 Kbps   so 4115 Kbps   erro 0   NET   lo        pcki 4082   pcko 4082   si 8967 Kbps   so 8967 Kbps   erro 0   PID TID THR SYSCPU USRCPU VGROW RGROW RDDSK WRDSK ST EXC S CPUNR CPU CMD 1 12 9783   156 0 21s 19 44s 0K  788K 4K 1344K      S 4 19",
        "objectID": "troubleshooting/handle/high-load"
    },
    {
        "title": "内存碎片化",
        "uri": "troubleshooting/handle/memory-fragmentation",
        "content": "mysqld  page allocation failure  order 4  mode 0x10c0d0 mysqld            order               2 order      4    2 4 16       mode                      include linux gfp h                                       GFPKERNEL   GFPRECLAIM   GFPIO   GFPFS         GFPRECLAIM    GFPDIRECT_RECLAIM GFPKSWAPDRECLAIM         order   0                   order                                                K8S      pod    netns     network namespace       netns        nf _conntrack    cache                                            v2 6 33   v4 6    runc  1 CHILD   page allocation failure  order 6  mode 0x10c0d0 Pod         ContainerCreating dockerd              Jan 23 14 15 31 dc05 dockerd  time  2019 01 23T14 15 31 288446233 08 00  level error msg  containerd  start container  error  oci runtime error  containerlinux go 247  starting container process caused   processlinux go 245  running exec setns process init caused     exit status 6       n  id 5b9be8c5bb121264899fac8d9d36b02150269d41ce96ba6ad36d70b8640cb01c Jan 23 14 15 31 dc05 dockerd  time  2019 01 23T14 15 31 317965799 08 00  level error msg  Create container failed error  invalid header field value   oci runtime error  containerlinux go 247  starting container process caused     processlinux go 245  running exec setns process init caused         exit status 6              n    kubelet       Jan 23 14 15 31 dc05 kubelet  E0123 14 15 31 352386 26037 remoteruntime go 91  RunPodSandbox runtime service failed  rpc error  code   2 desc   failed start sandbox container pod  matchdataserver 1255064836 t4b2w   Error response daemon    message   invalid header field value   oci runtime error  containerlinux go 247  starting container process caused     process_linux go 245  running exec setns process init caused         exit status 6              n     Jan 23 14 15 31 dc05 kubelet  E0123 14 15 31 352496 26037 kuberuntimesandbox go 54  CreatePodSandbox pod  matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea   failed  rpc error  code   2 desc   failed start sandbox container pod  matchdataserver 1255064836 t4b2w   Error response daemon    message   invalid header field value   oci runtime error  containerlinux go 247  starting container process caused     processlinux go 245  running exec setns process init caused         exit status 6              n     Jan 23 14 15 31 dc05 kubelet  E0123 14 15 31 352518 26037 kuberuntimemanager go 618  createPodSandbox pod  matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea   failed  rpc error  code   2 desc   failed start sandbox container pod  matchdataserver 1255064836 t4b2w   Error response daemon    message   invalid header field value   oci runtime error  containerlinux go 247  starting container process caused     processlinux go 245  running exec setns process init caused         exit status 6              n     Jan 23 14 15 31 dc05 kubelet  E0123 14 15 31 352580 26037 podworkers go 182  Error syncing pod 485fd485 1ed6 11e9 8661 0a587f8021ea   matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea     skipping  failed  CreatePodSandbox   matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea   CreatePodSandboxError   CreatePodSandbox pod   matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea    failed  rpc error  code   2 desc   failed start sandbox container pod   matchdataserver 1255064836 t4b2w    Error response daemon     message     invalid header field value     oci runtime error  containerlinux go 247  starting container process caused         processlinux go 245  running exec setns process init caused                 exit status 6                            n         Jan 23 14 15 31 dc05 kubelet  I0123 14 15 31 372181 26037 kubelet go 1916  SyncLoop  PLEG    matchdataserver 1255064836 t4b2w_basic 485fd485 1ed6 11e9 8661 0a587f8021ea    event   pleg PodLifecycleEvent ID  485fd485 1ed6 11e9 8661 0a587f8021ea   Type  ContainerDied   Data  5b9be8c5bb121264899fac8d9d36b02150269d41ce96ba6ad36d70b8640cb01c   Jan 23 14 15 31 dc05 kubelet  W0123 14 15 31 372225 26037 podcontainerdeletor go 77  Container  5b9be8c5bb121264899fac8d9d36b02150269d41ce96ba6ad36d70b8640cb01c  not found pod s containers Jan 23 14 15 31 dc05 kubelet  I0123 14 15 31 678211 26037 kuberuntimemanager go 383  No ready sandbox pod  matchdataserver 1255064836 t4b2wbasic 485fd485 1ed6 11e9 8661 0a587f8021ea   found  Need start new one   slab      0                    cat  proc buddyinfo Node 0  zone DMA 1 0 1 0 2 1 1 0 1 1 3 Node 0  zone DMA32 2725 624 489 178 0 0 0 0 0 0 0 Node 0  zone Normal 1163 1101 932 222 0 0 0 0 0 0 0    OOM                                                                                OOM                          drop _cache    echo 3    proc sys vm drop_caches                                      echo 1    proc sys vm compact_memory           TODO          https   huataihuang gitbooks io cloud atlas content os linux kernel memory drop caches and compact memory html",
        "objectID": "troubleshooting/handle/memory-fragmentation"
    },
    {
        "title": "PID 耗尽",
        "uri": "troubleshooting/handle/pid-full",
        "content": "PID             PID         PID       cat  proc sys kernel pid_max            cat  proc sys kernel threads max              ulimit                 PID            PID     ps  eLf   wc  l        PID            PID                              Cannot allocate memory               4 1        https   github com torvalds linux commit 35f71bc0a09a45924bed268d8ccd0d3407bc476f           PID         echo 65535    proc sys kernel pid_max echo 65535    proc sys kernel threads max      PID         echo  kernel pid_max 65535       etc sysctl conf    sysctl  p echo  kernel threads max 65535       etc sysctl conf    sysctl  p k8s 1 14       Pod        https   kubernetes io blog 2019 04 15 process id limiting for stability improvements in kubernetes 1 14",
        "objectID": "troubleshooting/handle/pid-full"
    },
    {
        "title": "inotify watch 耗尽",
        "uri": "troubleshooting/handle/runnig-out-of-inotify-watches",
        "content": "linux          fd    inotify     fd    watch                inotify     fd    watch                             fs inotify maxuserwatches      inotify watch      cat  proc sys fs inotify maxuserwatches 8192              inotify watch    fd         fd watch                      usr bin env bash Copyright 2019  c  roc script shows processes holding inotify fd  alone directories inotify fd watches 0 will ignored   total 0 result  EXE PID FD INFO INOTIFY WATCHES n  read pid fd    exe    readlink  f  proc  pid exe    echo n a      fdinfo   proc  pid fdinfo  fd      count    grep  c inotify   fdinfo     true           count      0    total    total count      result    exe  pid  fdinfo  count n     fi done    etc sysctl conf    sysctl  p    inotify add watch        debug inotify watch        echo 1     sys kernel debug tracing events syscalls sysexitinotifyaddwatch enable",
        "objectID": "troubleshooting/handle/runnig-out-of-inotify-watches"
    },
    {
        "title": "网络排错",
        "uri": "troubleshooting/network",
        "content": "children",
        "objectID": "troubleshooting/network",
        "weight": 50
    },
    {
        "title": "DNS 解析异常",
        "uri": "troubleshooting/network/dns",
        "content": "5       DNS      5             conntrack                  DNS 5                DNS             DNS      kube dns coredns     Pod    Ready                                                        DNS       DNS   ACL                           Pod      Service               Pod     DNS                                  Pod     DNS   Pod              DNS",
        "objectID": "troubleshooting/network/dns"
    },
    {
        "title": "LB 健康检查失败",
        "uri": "troubleshooting/network/lb-healthcheck-failed",
        "content": "nodeport           30000 32768     iptables        LB IP    kube ipvs0      IP  LB IP     https   github com kubernetes kubernetes issues 79783 TODO",
        "objectID": "troubleshooting/network/lb-healthcheck-failed"
    },
    {
        "title": "网络性能差",
        "uri": "troubleshooting/network/low-throughput",
        "content": "IPVS                connreusemode  sysctl net ipv4 vs connreusemode 0    issue  https   github com kubernetes kubernetes issues 70747",
        "objectID": "troubleshooting/network/low-throughput"
    },
    {
        "title": "Service 无法解析",
        "uri": "troubleshooting/network/service-cannot-resolve",
        "content": "DNS         kube dns CoreDNS        DNS         kubelet        cluster dns      dns     cluster ip    ps  ef   grep kubelet      usr bin kubelet   cluster dns 172 16 14 217        dns   service    kubectl svc  n kube system   grep 172 16 14 217 kube dns ClusterIP 172 16 14 217 53 TCP 53 UDP 47d       endpoint    kubectl  n kube system describe svc kube dns   grep  i endpoints Endpoints  172 16 0 156 53 172 16 0 167 53 Endpoints  172 16 0 156 53 172 16 0 167 53    endpoint      pod         kubectl  n kube system pod  o wide   grep 172 16 0 156 kube dns 898dbbfc6 hvwlr 3 3 Running 0 8d 172 16 0 156 10 0 0 3 Pod   DNS              pod       dns        pod   telnet    dns   53       dns service   cluster ip   telnet 172 16 14 217 53                                                              iptables",
        "objectID": "troubleshooting/network/service-cannot-resolve"
    },
    {
        "title": "Service 不通",
        "uri": "troubleshooting/network/service-unrecheable",
        "content": "dns    TODO                  iptables       TODO kube proxy         netlink deadlock   bug issue  https   github com kubernetes kubernetes issues 71071 1 14           PR  https   github com kubernetes kubernetes pull 72361",
        "objectID": "troubleshooting/network/service-unrecheable",
        "state": "Alpha"
    },
    {
        "title": "节点排错",
        "uri": "troubleshooting/node",
        "content": "children",
        "objectID": "troubleshooting/node",
        "weight": 30
    },
    {
        "title": "arp_cache: neighbor table overflow! (arp缓存溢出)",
        "uri": "troubleshooting/node/arp_cache-neighbor-table-overflow",
        "content": "arp            arp        arp  an   wc  l 1335    gc       sysctl  a   grep net ipv4 neigh default gc_thresh net ipv4 neigh default gc_thresh1   128 net ipv4 neigh default gc_thresh2   512 net ipv4 neigh default gc_thresh3   1024    arp       gcthresh3      overflow     arp      gcthresh3        gc                       IP   arp cache      mac            arp cache      1      gc_thresh3                 neighbor table overflow                 node   pod                      ARP                                arp cache   gc        etc sysctl conf   net ipv4 neigh default gc_thresh1   80000 net ipv4 neigh default gc_thresh2   90000 net ipv4 neigh default gc_thresh3   100000    node   label    pod spec    nodeSelector    nodeAffnity   pod                       Scaling Kubernetes 2 500 Nodes  https   openai com blog scaling kubernetes to 2500 nodes",
        "objectID": "troubleshooting/node/arp_cache-neighbor-table-overflow"
    },
    {
        "title": "Cannot allocate memory",
        "uri": "troubleshooting/node/cannot-allocate-memory",
        "content": "Cannot allocate memory  PID         ssh                     Cannot allocate memory     PID                     PID",
        "objectID": "troubleshooting/node/cannot-allocate-memory"
    },
    {
        "title": "soft lockup (内核软死锁)",
        "uri": "troubleshooting/node/kernel-solft-lockup",
        "content": "Oct 14 15 13 05 VM16_centos kernel  NMI watchdog  BUG  soft lockup   CPU 5 stuck 22s   runc  1 CHILD  2274                                                                                                               bug                      Bug  soft lockup  messages   https   www suse com support kb doc  id 7017652",
        "objectID": "troubleshooting/node/kernel-solft-lockup"
    },
    {
        "title": "no space left on device",
        "uri": "troubleshooting/node/no-space-left-on-device",
        "content": "NotReady  kubelet     no space left device       Pod    describe pod   event   no space left device                                inotify watch       NotReady kubelet        kubelet     Jul 18 15 20 58 VM1616centos kubelet 11519   E0718 15 20 58 280275 11519 raw go 140  Failed watch directory   sys fs cgroup memory kubepods   inotifyadd_watch  sys fs cgroup memory kubepods burstable pod926b7ff4 7bff 11e8 945b 52540048533c 6e85761a30707b43ed874e0140f58839618285fc90717153b3cbe7f91629ef5a  no space left device      inotifyaddwatch       no space left device            watch                                           inotify watch    cgroup         cgroup       cat  proc cgroups   column  t  subsysname hierarchy numcgroups enabled cpuset 5 29 1 cpu 7 126 1 cpuacct 7 126 1 memory 9 127 1 devices 4 126 1 freezer 2 29 1 net_cls 6 29 1 blkio 10 126 1 perf_event 3 29 1 hugetlb 11 29 1 pids 8 126 1 net_prio 6 29 1 cgroup                             cgroup                       cgroup         proc cgroups              find  L  sys fs cgroup memory  type d   wc  l 127   cgroup                              65535   cgroup      kmem    cgroup                     cgroup        65535        cgroup        no space left device               cgroup          TODO  Pod         CreateContainerError  csi cephfsplugin 27znb 0 2 CreateContainerError 167 17h Pod       Warning Failed 5m1s  x3397 17h  kubelet  ip 10 0 151 35 us west 2 compute internal  combined similar events   Error  container create failed  containerlinux go 336  starting container process caused  processlinux go 399  container init caused   rootfs_linux go 58  mounting      sys     rootfs      var lib containers storage overlay 051e985771cc69f3f699895a1dada9ef6483e912b46a99e004af7bb4852183eb merged          var lib containers storage overlay 051e985771cc69f3f699895a1dada9ef6483e912b46a99e004af7bb4852183eb merged sys     caused     no space left device",
        "objectID": "troubleshooting/node/no-space-left-on-device"
    },
    {
        "title": "Node NotReady",
        "uri": "troubleshooting/node/not-ready",
        "content": "",
        "objectID": "troubleshooting/node/not-ready",
        "state": "TODO"
    },
    {
        "title": "其它排错",
        "uri": "troubleshooting/others",
        "content": "children",
        "objectID": "troubleshooting/others",
        "weight": 70
    },
    {
        "title": "Daemonset 没有被调度",
        "uri": "troubleshooting/others/daemonset-not-scheduled",
        "content": "Daemonset        0       controller manager   bug    controller manager      controller manager",
        "objectID": "troubleshooting/others/daemonset-not-scheduled",
        "state": "Alpha"
    },
    {
        "title": "Job 无法被删除",
        "uri": "troubleshooting/others/job-cannot-delete",
        "content": "k8s    bug  https   github com kubernetes kubernetes issues 43168           Running Succeed      Completions        kubectl     delete job      debug    v 8      kubectl          timeout     kubectl        job       pod         kubectl    1 12        kubectl    job      cascade false       job   pod                pod   kubectl delete job   cascade false",
        "objectID": "troubleshooting/others/job-cannot-delete"
    },
    {
        "title": "kubectl 执行 exec 或 logs 失败",
        "uri": "troubleshooting/others/kubectl-exec-or-logs-failed",
        "content": "apiserver    gt  kubelet 10250         10250   kubelet         kubectl exec   kubectl logs       apiserver   kubelet kubelet           dockerd             kubelet 10250     apiserver          iptables       10250       IP",
        "objectID": "troubleshooting/others/kubectl-exec-or-logs-failed",
        "state": "Alpha"
    },
    {
        "title": "Namespace 卡在 Terminating",
        "uri": "troubleshooting/others/namespace-stuck-on-terminating",
        "content": "Namespace     Finalizers    ns        Terminating          finalizers    kubectl ns xxx  o yaml         finalizers    kubectl ns  o yaml kube node lease apiVersion  v1 kind  Namespace metadata      finalizers  finalizers kubesphere io namespaces labels  kubesphere io workspace  system workspace name  kube node lease ownerReferences  apiVersion  tenant kubesphere io v1alpha1 blockOwnerDeletion  true controller  true kind  Workspace name  system workspace uid  d4310acd 1fdc 11ea a370 a2c490b9ae47 spec               kubesphere             finalizers           k8s     metadata       finalizers                                        metadata    finalizers                                                           finalizers                     Rancher             finalizers              finalizer               terminating       finalizer             kubectl edit ns xx    spec finalizers    k8s         1            namespace finalizers      namespace   finalize    subresource        API           PUT          kubectl proxy           curl        finalizers  curl  H  Content Type  application json   XPUT  d    apiVersion   v1   kind   Namespace   metadata    name   delete me    spec    finalizers        http   localhost 8001 api v1 namespaces delete me finalize      delete me     namespace          Node Lease   Proposal  https   github com kubernetes enhancements blob master keps sig node 0009 node heartbeat md metrics server        ns   apiserver           api            api                            Terminating            prometheus adapter     resource metrics api   prometheus adapter           kubectl apiservice     v1beta1 metrics k8s io monitoring prometheus adapter False  ServiceNotFound  75d",
        "objectID": "troubleshooting/others/namespace-stuck-on-terminating",
        "state": "Alpha"
    },
    {
        "title": "Node 全部消失",
        "uri": "troubleshooting/others/node-all-gone",
        "content": "Rancher    Node               rancher         rancher             kubectl delete ns local       rancher     namespace             node        kubectl node      node         rancher    rancher    nodes management cattle io    CRD       node      node         CRD    metadata        finalizer    user node remove_local     finalizer             k8s node        delete ns local         nodes management cattle io    CRD         rancher   finalizer          k8s node          node    kubectl node      node                          rancher           delete ns local",
        "objectID": "troubleshooting/others/node-all-gone",
        "state": "Alpha"
    },
    {
        "title": "APIServer 响应慢",
        "uri": "troubleshooting/others/slow-apiserver",
        "content": "",
        "objectID": "troubleshooting/others/slow-apiserver",
        "state": "TODO"
    },
    {
        "title": "Pod 排错",
        "uri": "troubleshooting/pod",
        "content": "Pod         Pod                                          Pod     kubectl pod  o wide    Pod   yaml     kubectl pod  o yaml    Pod     kubectl describe pod         kubectl logs   c   Pod    Pod               Error  Pod           NodeLost  Pod        Unkown  Pod               Waiting  Pod      Pending  Pod       ContainerCreating  Pod         Terminating  Pod       CrashLoopBackOff       kubelet        InvalidImageName           ImageInspectError         ErrImageNeverPull           ImagePullBackOff         RegistryUnavailable           ErrImagePull            CreateContainerConfigError       kubelet         CreateContainerError         RunContainerError         PreStartHookError     preStart hook    PostStartHookError     postStart hook    ContainersNotInitialized            ContainersNotReady           ContainerCreating       PodInitializing pod      DockerDaemonNotReady docker        NetworkPluginNotReady                                                                                                 children",
        "objectID": "troubleshooting/pod",
        "weight": 40
    },
    {
        "title": "容器进程主动退出",
        "uri": "troubleshooting/pod/container-proccess-exit-by-itself",
        "content": "0 128                   0 1 127                                              panic                         BUG                       DNS                DNS                     service            DNS                                        Pod       DNS       DNS               Service",
        "objectID": "troubleshooting/pod/container-proccess-exit-by-itself"
    },
    {
        "title": "Pod 健康检查失败",
        "uri": "troubleshooting/pod/healthcheck-failed",
        "content": "Kubernetes             readinessProbe         livenessProbe   pod             pod ip   service        service                     pod pod          kubelet                                  BUG             unhealthy                               initialDelaySeconds                             successThreshold      1           kill    pod       kill            cpu                            timeout    kubelet    pod                                                  systemtap                              netstat  tunlp                            reset             20 15 17 890996 IP 172 16 2 1 38074   172 16 2 23 8888  Flags  S   seq 96880261  win 14600  options  mss 1424 nop nop sackOK nop wscale 7   length 0 20 15 17 891021 IP 172 16 2 23 8888   172 16 2 1 38074  Flags  R    seq 0  ack 96880262  win 0  length 0 20 15 17 906744 IP 10 0 0 16 54132   172 16 2 23 8888  Flags  S   seq 1207014342  win 14600  options  mss 1424 nop nop sackOK nop wscale 7   length 0 20 15 17 906766 IP 172 16 2 23 8888   10 0 0 16 54132  Flags  R    seq 0  ack 1207014343  win 0  length 0                                        hostNetwork            Pod       Pod             Pod                    Pod         kubelet     Pod              Pod                   SYN backlog      SYN backlog     SYN                      SYN backlog                    netstat  s   grep TCPBacklogDrop            backlog                   backlog              backlog          net ipv4 tcpmaxsyn_backlog",
        "objectID": "troubleshooting/pod/healthcheck-failed"
    },
    {
        "title": "Pod 一直处于 ContainerCreating 或 Waiting 状态",
        "uri": "troubleshooting/pod/keep-containercreating-or-waiting",
        "content": "Pod                                   Volume    Volume                          Pod                       K8S             Volume                       kubelet          apiserver                                  Pod              Node                             cloud controller manager                                           cloud controller manager                  Pod               ContainerCreating                               cloud controller manager     bug     K8S    configmap secret   subpath   bug        Pod     configmap   secret          configmap   secret     Pod                      kill              K8S     bug          PR  https   github com kubernetes kubernetes pull 82784                                   kubectl  n prod pod  o yaml manage 5bd487cf9d bqmvm     lastState  terminated containerID  containerd   e6746201faa1dfe7f3251b8c30d59ebf613d99715f3b800740e587e681d2a903 exitCode  128 finishedAt  2019 09 15T00 47 22Z message   failed create containerd task  OCI runtime create failed  container_linux go 345  starting container process caused  process_linux go 424  container init caused   rootfs_linux go 58  mounting      var lib kubelet pods 211d53f4 d08c 11e9 b0a7 b6655eaf02a6 volume subpaths manage config volume manage 0     rootfs      run containerd io containerd runtime v1 linux k8s io e6746201faa1dfe7f3251b8c30d59ebf613d99715f3b800740e587e681d2a903 rootfs          run containerd io containerd runtime v1 linux k8s io e6746201faa1dfe7f3251b8c30d59ebf613d99715f3b800740e587e681d2a903 rootfs app resources application properties     caused     no file directory         unknown          Pod    CRI                                                                     Events  Type Reason Age Message                               Warning FailedCreatePodSandBox 2m  x4307 16h  kubelet  10 179 80 31  combined similar events   Failed create pod sandbox  rpc error  code   Unknown desc   failed create sandbox pod  apigateway 6dc48bf8b6 l8xrw   Error response daemon  mkdir  var lib docker aufs mnt 1f09d6c1c9f24e8daaea5bf33a4230de7dbc758e3b22785e8ee21e3e3d921214 init  no space left device                                                                                        limit               limit                Sandbox                 memory limit           limit         memory   limit     request        m       memory        k8s     byte      Mi   M            memory limit    1024m      1 024 Byte         pause          cgroup oom kill      pod        ContainerCreating              event  Pod sandbox changed  will killed re created  kubelet     start sandbox container pod     Error response daemon  OCI runtime create failed  containerlinux go 348  starting container process caused  processlinux go 301  running exec setns process init caused   signal  killed     unknown                                     Kubelet               pause     gcr io                         imagePullSecret                            kubelet     image pull progress deadline     runtime request timeout     CNI           CNI                                                  Pod         Pod IP controller manager       master   kube controller manager                 docker                  docker              docker     centos    yum     yum install  y docker         dockerd              Pod      ContainerCreating    event     Type Reason Age Message                               Warning FailedCreatePodSandBox 18m  x3583 83m  kubelet  192 168 4 5  combined similar events   Failed create pod sandbox  rpc error  code   Unknown desc   failed start sandbox container pod  nginx 7db9fccd9b 2j6dh   Error response daemon  ttrpc  client shutting down  read unix      containerd shim moby de2bfeefc999af42783115acca62745e6798981dff75f4148fae8c086668f667 shim sock  read  connection reset peer  unknown Normal SandboxChanged 3m12s  x4420 83m  kubelet  192 168 4 5 Pod sandbox changed  will killed re created            docker                       dockerd                                 sandbox      event  Warning FailedCreatePodSandBox 2m kubelet  10 205 8 91 Failed create pod sandbox  rpc error  code   Unknown desc   failed create sandbox pod  lomp ext d8c8b8c46 4v8tl   operation timeout  context deadline exceeded Warning FailedCreatePodSandBox 3s  x12 2m  kubelet  10 205 8 91 Failed create pod sandbox  rpc error  code   Unknown desc   failed create sandbox pod  lomp ext d8c8b8c46 4v8tl   Error response daemon  Conflict  container name   k8sPODlomp ext d8c8b8c46 4v8tldefault65046a06 f795 11e9 9bb6 b67fb7a70bad_0  already use container  30aa3f5847e0ce89e9d411e76783ba14accba7eb7743e605a10a9a862a72c1e2   remove  or rename  container able reuse name",
        "objectID": "troubleshooting/pod/keep-containercreating-or-waiting"
    },
    {
        "title": "Pod 处于 CrashLoopBackOff 状态",
        "uri": "troubleshooting/pod/keep-crashloopbackoff",
        "content": "Pod      CrashLoopBackOff                        Pod   restartPolicy                Pod   RestartCounts       0                                        ExitCode    Pod                                      0 128              BUG                            OOM        OOM      Pod           137     SIGKILL               memory  Kill process                   K8S                   kubelet     kube reserved     system reserved                               Pod                sys fs cgroup memory kubepods    cgroup            capacity    kube reserved     system reserved                        kubelet  dockerd  kube proxy  sshd             kubelet                OOM                   cgroup OOM     cgrou OOM         Pod      Reason       OOMKilled               limit             Memory cgroup memory            limit                                                                                Pod",
        "objectID": "troubleshooting/pod/keep-crashloopbackoff"
    },
    {
        "title": "Pod 一直处于 Error 状态",
        "uri": "troubleshooting/pod/keep-error",
        "content": "TODO            Error      Pod                         ConfigMap Secret    PV                             LimitRange                   PodSecurityPolicy                     RBAC       ServiceAccount",
        "objectID": "troubleshooting/pod/keep-error"
    },
    {
        "title": "Pod 一直处于 ImageInspectError 状态",
        "uri": "troubleshooting/pod/keep-imageinspecterror",
        "content": "TODO",
        "objectID": "troubleshooting/pod/keep-imageinspecterror"
    },
    {
        "title": "Pod 一直处于 ImagePullBackOff 状态",
        "uri": "troubleshooting/pod/keep-imagepullbackoff",
        "content": "http    registry        insecure registry dockerd     https     registry           https     registry          insecure registry           reload dockerd     https       resitry         ca       registry   https             dockerd     registry                               registry   ca        etc docker certs d  ca crt                   registry         Pod      imagePullSecret     Secret                          push                        push                       Pod                                               Pod          kubelet             serialize image pulls Pull images one time  recommend not changing default value nodes run docker daemon version 0  limit registry pull QPS value  0  unlimited   default 5    registry burst int32 Maximum size bursty pulls  temporarily allows pulls burst number  not exceeding registry qps  used   registry qps   0  default 10         kubelet     PullImage  imroc test v0 2  image service failed  rpc error  code   Unknown desc   Error response daemon  manifest imroc test v0 2 not found",
        "objectID": "troubleshooting/pod/keep-imagepullbackoff"
    },
    {
        "title": "Pod 一直处于 Pending 状态",
        "uri": "troubleshooting/pod/keep-pending",
        "content": "Pending      Pod                   Pod                 kubectl describe pod tikv 0     Events  Type Reason Age Message                               Warning FailedScheduling 3m  x106 33m  default scheduler 0 4 nodes available  1 node s  no available volume zone  2 Insufficient cpu  3 Insufficient memory                                        CPU                        GPU                 GPU              Node            kubectl describe node    node              Allocatable                 Allocated resources               Allocatable         Pod    Request                              Pod   request      Pod       Scheduler   Predicates                Node               nodeSelector   affinity    Pod    nodeSelector            label           Pod         label   Node        Node     label       label   Node                       https   kubernetes io docs concepts configuration assign pod node  nodeselector    Pod    affinity                               Node        affinity        nodeAffinity                  nodeSelector      Pod             Node  podAffinity  Pod               Pod                                     podAntiAffinity  Pod               Pod                      DNS     Pod                           DNS              Node    Pod                    Taints    Pod          Tolerations  Pod             describe node      Node     Taints    kubectl describe nodes host1     Taints  special true NoSchedule                      kubectl taint nodes host1 special    Pod            tolerations  key   special  operator   Equal  value   true  effect   NoSchedule                                                                             kubectl taint node host1 special true NoSchedule node  host1  tainted                      Pod                              node kubernetes io unschedulable                                        v1 12    TaintNodesByCondition      Beta      controller manager     Node   Condition            Node            Condition   Taints          Conditon Value Taints OutOfDisk True node kubernetes io out of disk Ready False node kubernetes io not ready Ready Unknown node kubernetes io unreachable MemoryPressure True node kubernetes io memory pressure PIDPressure True node kubernetes io pid pressure DiskPressure True node kubernetes io disk pressure NetworkUnavailable True node kubernetes io network unavailable               OutOfDisk   True             Ready   False         Ready   Unknown          node monitor grace period               controller manager     Node      Unknown     40s  MemoryPressure   True                    PIDPressure   True              PID        DiskPressure   True                 NetworkUnavailable   True                      Pod                     TKE            Node    node cloudprovider kubernetes io uninitialized       Node                    Pod            Node        kube scheduler   bug        kube scheduler   bug              kube scheduler           maser    kube scheduler                                                                                                                 Pod                                                                                                      Pod                                                                                    IO",
        "objectID": "troubleshooting/pod/keep-pending"
    },
    {
        "title": "Pod 一直处于 Terminating 状态",
        "uri": "troubleshooting/pod/keep-terminating",
        "content": "docker              docker                       kubelet    docker           event       Normal Killing 39s  x735 15h  kubelet  10 179 80 31 Killing container id docker   apigateway Need kill Pod                         i                                i                       Pod                               Pod          Terminating kubelet     Sep 27 14 37 21 VM07centos kubelet 14109   E0927 14 37 21 922965 14109 remoteruntime go 250  RemoveContainer  19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257  runtime service failed  rpc error  code   Unknown desc   failed remove container  19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257   Error response daemon  container 19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257  driver  overlay2  failed remove root filesystem  remove  data docker overlay2 b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868 diff usr bin bash  operation not permitted Sep 27 14 37 21 VM07centos kubelet 14109   E0927 14 37 21 923027 14109 kuberuntimegc go 126  Failed remove container  19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257   rpc error  code   Unknown desc   failed remove container  19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257   Error response daemon  container 19d837c77a3c294052a99ff9347c520bc8acb7b8b9a9dc9fab281fc09df38257  driver  overlay2  failed remove root filesystem  remove  data docker overlay2 b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868 diff usr bin bash  operation not permitted    man chattr     i          file  i  attribute cannot modified  cannot deleted renamed  no link created file no data written file  superuser process possessing CAPLINUXIMMUTABLE capability set clear attribute                            i                  kubelet                  chattr  i   chattr  i  data docker overlay2 b1aea29c590aa9abda79f7cf3976422073fb3652757f0391db88534027546868 diff usr bin bash        kubelet      Pod            docker 17   bug docker hang            event  Warning FailedSync 3m  x408 1h  kubelet  10 179 80 31 error determining status  rpc error  code   DeadlineExceeded desc   context deadline exceeded    17  dockerd BUG     kubectl  n cn staging delete pod apigateway 6dc48bf8b6 clcwk   force   grace period 0     pod   docker ps                   docker 18           containerd     bug           terminating                                              Finalizers k8s     metadata       finalizers                            metadata    finalizers                                                         finalizers                     Rancher             finalizers          kubectl edit             finalizers                       kubelet list watch   bug         v1 8 13     k8s kubelet    list watch        pod   kubelet          kubelet             pod       Terminating dockerd   containerd           dockerd   containerd                describe pod      id docker ps          dockerd           docker container ctr       containerd            docker container ctr   namespace moby   address  var run docker containerd docker containerd sock task ls  grep a9a1785b81343c3ad2093ad973f4f8e52dbf54823b8bb089886c8356d4036fe0 a9a1785b81343c3ad2093ad973f4f8e52dbf54823b8bb089886c8356d4036fe0 30639 STOPPED containerd        stopped            docker         runing    dockerd   containerd                   docker   aufs                   panic   aufs auoptsverify 1597 dockerd 5347   dirperm1 breaks protection permission bits lower branch         dockerd              Sep 18 10 19 49 VM 1 33 ubuntu dockerd 4822   time  2019 09 18T10 19 49 903943652 08 00  level error msg  Failed log msg      logger json file  write  opt docker containers 54922ec8b1863bcc504f6dac41e40139047f7a84ff09175d2800100aaccbad1f 54922ec8b1863bcc504f6dac41e40139047f7a84ff09175d2800100aaccbad1f json log  no space left device                issue  https   github com docker for linux issues 779          docker container prune     dockerd                 containerd    dockerd    docker       BUG Daemonset Controller   BUG    k8s   bug     daemonset pod    terminating 1 10   1 11           daemonset controller    scheduler   predicates        nodeAffinity   nodeSelector              spec     apiserver       daemonset controller     rollingUpdate     hash     spec                            issue  https   github com kubernetes kubernetes issues 66298    PR  https   github com kubernetes kubernetes pull 66480                      rollingUpdate    daemonset     nodeAffinity    nodeSelector",
        "objectID": "troubleshooting/pod/keep-terminating"
    },
    {
        "title": "Pod 一直处于 Unknown 状态",
        "uri": "troubleshooting/pod/keep-unkown",
        "content": "TODO                     apiserver       controller manager               Unknown",
        "objectID": "troubleshooting/pod/keep-unkown"
    },
    {
        "title": "Pod Terminating 慢",
        "uri": "troubleshooting/pod/slow-terminating",
        "content": "bash  c      kill",
        "objectID": "troubleshooting/pod/slow-terminating",
        "state": "Alpha"
    },
    {
        "title": "排错技巧",
        "uri": "troubleshooting/trick",
        "content": "children",
        "objectID": "troubleshooting/trick",
        "weight": 10
    },
    {
        "title": "分析 ExitCode 定位 Pod 异常退出原因",
        "uri": "troubleshooting/trick/analysis-exitcode",
        "content": "kubectl describe pod      pod      Containers  kubedns  Container ID  docker   5fb8adf9ee62afc6d3f6f3d9590041818750b392dff015d7091eaaf99cf1c945 Image  ccr ccs tencentyun com library kubedns amd64 1 14 4 Image ID  docker pullable   ccr ccs tencentyun com library kubedns amd64 sha256 40790881bbe9ef4ae4ff7fe8b892498eecb7fe6dcc22661402f271e03f7de344 Ports  10053 UDP  10053 TCP  10055 TCP Host Ports  0 UDP  0 TCP  0 TCP Args    domain cluster local    dns port 10053   config dir  kube dns config   v 2 State  Running Started  Tue  27 Aug 2019 10 58 49  0800 Last State  Terminated Reason  Error Exit Code  255 Started  Tue  27 Aug 2019 10 40 42  0800 Finished  Tue  27 Aug 2019 10 58 27  0800 Ready  True Restart Count  1         Last State       ExitCode                   0                                0 255    0                           129 255                    kill  9   SIGKILL ctrl c   SIGINT                        1 128                   129 255                             0 255        exit  1                          0 255             code                         256     code    256                          code   256         137     SIGKILL                    pod                 resources limits            OOM   CPU                             linux   cgroup        cgroup               kill  9     describe pod       Reason   OOMKilled                  OOM                        cgroup                                             ubuntu         var log syslog centos         var log messages      journalctl  k              livenessProbe             kubelet     pod               1   255                                          exit 1    exit  1   1           255                     Appendix E  Exit Codes Special Meanings Linux        Linux                                    128        SIGKILL         9             9 128 137             Signal Value Action Comment                                                                        SIGHUP 1 Term Hangup detected controlling terminal death controlling process SIGINT 2 Term Interrupt keyboard SIGQUIT 3 Core Quit keyboard SIGILL 4 Core Illegal Instruction SIGABRT 6 Core Abort signal abort 3  SIGFPE 8 Core Floating point exception SIGKILL 9 Term Kill signal SIGSEGV 11 Core Invalid memory reference SIGPIPE 13 Term Broken pipe  write pipe no readers  pipe 7  SIGALRM 14 Term Timer signal alarm 2  SIGTERM 15 Term Termination signal SIGUSR1 30 10 16 Term User defined signal 1 SIGUSR2 31 12 17 Term User defined signal 2 SIGCHLD 20 17 18 Ign Child stopped terminated SIGCONT 19 18 25 Cont Continue stopped SIGSTOP 17 19 23 Stop Stop process SIGTSTP 18 20 24 Stop Stop typed terminal SIGTTIN 21 21 26 Stop Terminal input background process SIGTTOU 22 22 27 Stop Terminal output background process C C          usr include sysexits h                 C C       define EX_OK 0    successful termination     define EX__BASE 64    base value error messages     define EX_USAGE 64    command line usage error     define EX_DATAERR 65    data format error     define EX_NOINPUT 66    cannot open input     define EX_NOUSER 67    addressee unknown     define EX_NOHOST 68    host name unknown     define EX_UNAVAILABLE 69    service unavailable     define EX_SOFTWARE 70    internal software error     define EX_OSERR 71    system error  e g   can t fork      define EX_OSFILE 72    critical OS file missing     define EX_CANTCREAT 73    can t create  user  output file     define EX_IOERR 74    input output error     define EX_TEMPFAIL 75    temp failure  user invited retry     define EX_PROTOCOL 76    remote error protocol     define EX_NOPERM 77    permission denied     define EX_CONFIG 78    configuration error     define EX__MAX 78    maximum listed value",
        "objectID": "troubleshooting/trick/analysis-exitcode",
        "LastModifierDisplayName": "roc",
        "LastModifierURL": "https://imroc.io",
        "date": "2020-03-12T00:00:00.000Z"
    },
    {
        "title": "容器内抓包定位网络问题",
        "uri": "troubleshooting/trick/capture-packets-in-container",
        "content": "kubernetes                                                                                                                                                                     netns          tcpdump               pod netns                      1         pod       pod    kubectl pod  o wide    pod               shell              shell         function e     set  eu ns   2  default   pod kubectl  n  ns describe pod  1   grep  A10   Containers     grep  Eo  docker         head  n 1   sed  s docker             1   pid docker inspect  f    State Pid    pod echo  entering pod netns  ns  1  cmd  nsenter  n   target  pid  echo  cmd  cmd        pod     netns    e POD_NAME NAMESPACE     e istio galley 58c7c7c646 m6568 istio system e proxy 5546768954 9rxg6      NAMESPACE     default        pod   netns           ip   ifconfig             netstat  tunlp                   tcpdump     tcpdump  i eth0  w test pcap port 80 ctrl c         scp   sz               wireshark            wireshark          telnet                 lbtest                         tcp contains  lbtest          http        curl                       uri           http request uri    mytest                              pod       ID kubectl describe pod  n mservice         pid docker inspect  f    State Pid          network namespace nsenter  n   target          kubectl  docker  nsenter  grep  head  sed",
        "objectID": "troubleshooting/trick/capture-packets-in-container"
    },
    {
        "title": "使用 Systemtap 定位疑难杂症",
        "uri": "troubleshooting/trick/use-systemtap-to-locate-problems",
        "content": "Ubuntu    systemtap  apt install  y systemtap    stap prep               stap prep Please install linux headers 4 4 0 104 generic need package linux image 4 4 0 104 generic dbgsym does not seem available Ubuntu  dbgsym packages typically separate repository Follow https   wiki ubuntu com DebuggingProgramCrash add repository apt install  y linux headers 4 4 0 104 generic      dbgsym                                 dbgsym           wiki  https   wiki ubuntu com Kernel Systemtap    sudo apt key adv   keyserver keyserver ubuntu com   recv keys C8CAB6595FDFF622 codename   lsb_release  c   awk   print  2    sudo tee  etc apt sources list d ddebs list systemd 0m0 080000000s   vGhyM0 19491m2 579563677s   sh 33473m38 074571885s   bash 33473m38 077072025s   bash 33473m38 081028267s   bash 33475m4 817798337s   pkill 33475m5 202486630s       task_ancestry                           vGhyM0",
        "objectID": "troubleshooting/trick/use-systemtap-to-locate-problems"
    }
]